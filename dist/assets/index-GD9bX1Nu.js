const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BifurcationDiagram-BsnEZeAf.js","assets/three-vendor-B6sVHfeA.js","assets/BifurcationDiagram-7MOkXOt8.css","assets/PoincareSection-D6XrfZiz.js","assets/PoincareSection-Bu5ajD9c.css","assets/ParameterSpace-BwCudLVF.js","assets/ParameterSpace-U0tBLzM4.css"])))=>i.map(i=>d[i]);
import{V as L,c as fe,r as u,u as U,B as X,L as ie,A as se,j as e,a as oe,C as V,b as le,d as be,G as xe,O as ye,_ as ae,e as ve}from"./three-vendor-B6sVHfeA.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();class Se{points=[];position;params;dt=.01;perturbation=new L(1,0,0);lyapunovSum=0;lyapunovSteps=0;lyapunovExponent=0;RENORM_INTERVAL=10;stepsSinceRenorm=0;prevZ=0;prevDz=0;poincarePoints=[];MAX_POINCARE=5e3;constructor(t=new L(1,1,1),s){this.position=t.clone(),this.params=s,this.points=[this.position.clone()],this.prevZ=t.z}derivatives(t,s,a){const{sigma:n,rho:i,beta:l}=this.params;return[n*(s-t),t*(i-a)-s,t*s-l*a]}jacobianApply(t,s,a,n,i,l){const{sigma:d,rho:o,beta:h}=this.params;return[d*(i-n),(o-a)*n-i-t*l,s*n+t*i-h*l]}step(t=1){const s=this.dt*t,{x:a,y:n,z:i}=this.position,[l,d,o]=this.derivatives(a,n,i),[h,p,x]=this.derivatives(a+.5*s*l,n+.5*s*d,i+.5*s*o),[P,f,j]=this.derivatives(a+.5*s*h,n+.5*s*p,i+.5*s*x),[R,v,m]=this.derivatives(a+s*P,n+s*f,i+s*j);this.position.x+=s/6*(l+2*h+2*P+R),this.position.y+=s/6*(d+2*p+2*f+v),this.position.z+=s/6*(o+2*x+2*j+m),(!isFinite(this.position.x)||!isFinite(this.position.y)||!isFinite(this.position.z)||Math.abs(this.position.x)>1e6)&&this.position.set(1,1,1),this.points.push(this.position.clone());const M=this.perturbation.x,E=this.perturbation.y,k=this.perturbation.z,[T,w,g]=this.jacobianApply(this.position.x,this.position.y,this.position.z,M,E,k);if(this.perturbation.x+=T*s,this.perturbation.y+=w*s,this.perturbation.z+=g*s,this.stepsSinceRenorm++,this.stepsSinceRenorm>=this.RENORM_INTERVAL){const y=this.perturbation.length();if(y>0&&isFinite(y)){this.lyapunovSum+=Math.log(y),this.lyapunovSteps++,this.perturbation.divideScalar(y);const S=this.lyapunovSteps*this.RENORM_INTERVAL*this.dt;this.lyapunovExponent=this.lyapunovSum/S}this.stepsSinceRenorm=0}const b=this.position.z-this.prevZ;return this.prevDz>0&&b<=0&&this.points.length>100&&(this.poincarePoints.push([this.position.x,this.position.y]),this.poincarePoints.length>this.MAX_POINCARE&&this.poincarePoints.splice(0,this.poincarePoints.length-this.MAX_POINCARE)),this.prevDz=b,this.prevZ=this.position.z,this.position.clone()}reset(t=new L(1,1,1)){this.position=t.clone(),this.points=[this.position.clone()],this.perturbation.set(1,0,0),this.lyapunovSum=0,this.lyapunovSteps=0,this.lyapunovExponent=0,this.stepsSinceRenorm=0,this.prevZ=t.z,this.prevDz=0,this.poincarePoints=[]}updateParams(t){this.params={...this.params,...t}}trimTrail(t){this.points.length>t&&this.points.splice(0,this.points.length-t)}getSpeed(){if(this.points.length<2)return 0;const t=this.points[this.points.length-1],s=this.points[this.points.length-2];return t.distanceTo(s)}getParams(){return{...this.params}}}const A={classic:{bg:"#000010",bgRgb:"0,0,16",panelBg:"rgba(20, 20, 25, 0.95)",panelBorder:"rgba(255, 255, 255, 0.1)",text:"#cccccc",textMuted:"rgba(255,255,255,0.6)",accent:"#88ccff",accent2:"#aaffaa",heading:"#88ccff",paramColor:"#ffcc88",trailHue1:.55,trailHue2:.85,starColor:"#ffffff"},neon:{bg:"#000000",bgRgb:"0,0,0",panelBg:"rgba(10, 0, 20, 0.95)",panelBorder:"rgba(255, 0, 255, 0.25)",text:"#e0e0e0",textMuted:"rgba(255,255,255,0.5)",accent:"#ff00ff",accent2:"#00ffff",heading:"#ff44ff",paramColor:"#ffff00",trailHue1:.83,trailHue2:.5,starColor:"#ff88ff"},blueprint:{bg:"#0a1628",bgRgb:"10,22,40",panelBg:"rgba(15, 30, 60, 0.95)",panelBorder:"rgba(100, 160, 255, 0.3)",text:"#c0d8f0",textMuted:"rgba(192,216,240,0.6)",accent:"#4488ff",accent2:"#88bbff",heading:"#6699ff",paramColor:"#aaccff",trailHue1:.6,trailHue2:.58,starColor:"#4488ff"},terminal:{bg:"#000a00",bgRgb:"0,10,0",panelBg:"rgba(0, 15, 0, 0.95)",panelBorder:"rgba(0, 255, 0, 0.2)",text:"#00dd00",textMuted:"rgba(0,220,0,0.5)",accent:"#00ff00",accent2:"#88ff88",heading:"#00ff00",paramColor:"#44ff44",trailHue1:.33,trailHue2:.28,starColor:"#00ff00"}},C=fe(r=>({currentSystem:"lorenz",setCurrentSystem:t=>r({currentSystem:t}),isPlaying:!0,setIsPlaying:t=>r({isPlaying:t}),speed:1,setSpeed:t=>r({speed:t}),trailLength:1e3,setTrailLength:t=>r({trailLength:t}),sideBySideMode:!1,setSideBySideMode:t=>r({sideBySideMode:t}),initialOffset:.001,setInitialOffset:t=>r({initialOffset:t}),divergence:0,setDivergence:t=>r({divergence:t}),colorTheme:"classic",setColorTheme:t=>r({colorTheme:t}),lorenzParams:{sigma:10,rho:28,beta:8/3},setLorenzParams:t=>r(s=>({lorenzParams:{...s.lorenzParams,...t}})),rosslerParams:{a:.2,b:.2,c:5.7},setRosslerParams:t=>r(s=>({rosslerParams:{...s.rosslerParams,...t}})),doublePendulumParams:{mass1:1,mass2:1,length1:1,length2:1,gravity:9.81,damping:0},setDoublePendulumParams:t=>r(s=>({doublePendulumParams:{...s.doublePendulumParams,...t}})),currentPreset:null,setCurrentPreset:t=>r({currentPreset:t}),showInfoPanel:!0,setShowInfoPanel:t=>r({showInfoPanel:t}),autoRotate:!1,setAutoRotate:t=>r({autoRotate:t}),_resetCounter:0,resetSimulation:()=>{r(t=>({_resetCounter:t._resetCounter+1,isPlaying:!1})),setTimeout(()=>r({isPlaying:!0}),100)},showPerformanceWarning:!1,setShowPerformanceWarning:t=>r({showPerformanceWarning:t}),showLyapunov:!1,setShowLyapunov:t=>r({showLyapunov:t}),lyapunovExponent:0,setLyapunovExponent:t=>r({lyapunovExponent:t}),showBifurcation:!1,setShowBifurcation:t=>r({showBifurcation:t}),showPoincare:!1,setShowPoincare:t=>r({showPoincare:t}),showParameterSpace:!1,setShowParameterSpace:t=>r({showParameterSpace:t})})),ce={lorenz:[{name:"Classic Lorenz",description:"The original butterfly attractor",params:{sigma:10,rho:28,beta:8/3}},{name:"Edge of Chaos",description:"Parameters at the edge between order and chaos",params:{sigma:10,rho:24,beta:8/3}},{name:"Strange Attractor",description:"Different parameter set creating unique patterns",params:{sigma:12,rho:30,beta:2.5}}],rossler:[{name:"Classic RÃ¶ssler",description:"The standard RÃ¶ssler attractor parameters",params:{a:.2,b:.2,c:5.7}},{name:"Spiral Focus",description:"Creates tighter spiral patterns",params:{a:.1,b:.1,c:4}},{name:"Period Doubling",description:"Shows period-doubling route to chaos",params:{a:.15,b:.2,c:10}}],doublePendulum:[{name:"Equal Masses",description:"Two pendulums with equal mass and length",params:{mass1:1,mass2:1,length1:1,length2:1,gravity:9.81,damping:0}},{name:"Heavy Bottom",description:"Bottom pendulum twice as heavy",params:{mass1:1,mass2:2,length1:1,length2:1,gravity:9.81,damping:0}},{name:"With Damping",description:"Small damping showing energy dissipation",params:{mass1:1,mass2:1,length1:1,length2:1,gravity:9.81,damping:.05}}]},O=6e3,re=({points:r,hueStart:t,hueEnd:s,scale:a=1,flatZ:n=!1,glowIntensity:i=.6})=>{const l=u.useRef(null),d=u.useRef(null),o=u.useRef(null),h=u.useRef(null),{posBuffer:p,colorBuffer:x,glowColorBuffer:P}=u.useMemo(()=>({posBuffer:new Float32Array(O*3),colorBuffer:new Float32Array(O*3),glowColorBuffer:new Float32Array(O*3)}),[]);U(()=>{if(!o.current||!h.current)return;const R=Math.min(r.length,O);if(R<2){o.current.setDrawRange(0,0),h.current.setDrawRange(0,0);return}const v=Math.max(0,r.length-O),m=a;for(let w=0;w<R;w++){const g=r[v+w],b=w*3;p[b]=g.x*m,p[b+1]=g.y*m,p[b+2]=n?0:g.z*m;const y=w/(R-1),S=y*y,F=t+(s-t)*y,I=.85,B=.35+S*.45,N=(1-Math.abs(2*B-1))*I,G=(F%1+1)%1*6,$=N*(1-Math.abs(G%2-1)),_=B-N/2,Y=Math.floor(G)%6;let D=0,H=0,z=0;switch(Y){case 0:D=N,H=$;break;case 1:D=$,H=N;break;case 2:H=N,z=$;break;case 3:H=$,z=N;break;case 4:D=$,z=N;break;case 5:D=N,z=$;break}x[b]=(D+_)*S,x[b+1]=(H+_)*S,x[b+2]=(z+_)*S;const W=S*i;P[b]=(D+_)*W*1.5,P[b+1]=(H+_)*W*1.5,P[b+2]=(z+_)*W*1.5}const M=o.current.getAttribute("position"),E=o.current.getAttribute("color");M.set(p.subarray(0,R*3)),E.set(x.subarray(0,R*3)),M.needsUpdate=!0,E.needsUpdate=!0,o.current.setDrawRange(0,R);const k=h.current.getAttribute("position"),T=h.current.getAttribute("color");k.set(p.subarray(0,R*3)),T.set(P.subarray(0,R*3)),k.needsUpdate=!0,T.needsUpdate=!0,h.current.setDrawRange(0,R)}),u.useEffect(()=>{!o.current||!h.current||(o.current.setAttribute("position",new X(new Float32Array(O*3),3)),o.current.setAttribute("color",new X(new Float32Array(O*3),3)),o.current.setDrawRange(0,0),h.current.setAttribute("position",new X(new Float32Array(O*3),3)),h.current.setAttribute("color",new X(new Float32Array(O*3),3)),h.current.setDrawRange(0,0))},[]);const f=u.useMemo(()=>new ie({vertexColors:!0,transparent:!0,opacity:1,depthWrite:!1,blending:se}),[]),j=u.useMemo(()=>new ie({vertexColors:!0,transparent:!0,opacity:.4,depthWrite:!1,blending:se}),[]);return e.jsxs(e.Fragment,{children:[e.jsxs("primitive",{object:new oe,ref:l,children:[e.jsx("bufferGeometry",{ref:o}),e.jsx("primitive",{object:f,attach:"material"})]}),e.jsxs("primitive",{object:new oe,ref:d,children:[e.jsx("bufferGeometry",{ref:h}),e.jsx("primitive",{object:j,attach:"material"})]})]})},je=({position:r=[0,0,0],scale:t=.1,initialCondition:s=[1,1,1],isSecondary:a=!1,lastPosRef:n})=>{const i=u.useRef(null),{isPlaying:l,speed:d,trailLength:o,lorenzParams:h,_resetCounter:p,colorTheme:x,showLyapunov:P,setLyapunovExponent:f,showPoincare:j}=C(),R=A[x],v=u.useMemo(()=>{const g=new L(...s);return new Se(g,h)},[s[0],s[1],s[2],h.sigma,h.rho,h.beta]);u.useEffect(()=>{v.reset(new L(...s))},[p]),u.useEffect(()=>{v.updateParams(h)},[h,v]);const m=u.useRef(v);m.current=v,u.useEffect(()=>(a||(window.__chaosLabSystem=v,window.__chaosLabSystemType="lorenz"),()=>{!a&&window.__chaosLabSystem===v&&(window.__chaosLabSystem=null)}),[v,a]);const M=u.useRef([]),E=u.useRef(0);U(()=>{if(!l)return;v.step(d*.5),v.trimTrail(o);const g=v.points,b=[];for(let y=0;y<g.length;y++)b.push(new L(g[y].x*t,g[y].y*t,g[y].z*t));if(M.current=b,n&&g.length>0){const y=g[g.length-1];n.current=y.clone()}!a&&(P||j)&&(E.current++,E.current%30===0&&f(v.lyapunovExponent))});const k=a?R.trailHue2:R.trailHue1,T=k+.2,w=new V().setHSL(k+.15,1,.7);return e.jsxs("group",{ref:i,position:r,children:[e.jsx(re,{points:M.current,hueStart:k,hueEnd:T,lineWidth:2.5,glowIntensity:.5}),v.points.length>0&&(()=>{const g=v.points[v.points.length-1];return e.jsxs("mesh",{position:[g.x*t,g.y*t,g.z*t],children:[e.jsx("sphereGeometry",{args:[.04,12,12]}),e.jsx("meshBasicMaterial",{color:w,transparent:!0,opacity:.9})]})})()]})};class Pe{points=[];position;params;dt=.01;perturbation=new L(1,0,0);lyapunovSum=0;lyapunovSteps=0;lyapunovExponent=0;RENORM_INTERVAL=10;stepsSinceRenorm=0;prevY=0;poincarePoints=[];MAX_POINCARE=5e3;constructor(t=new L(1,1,1),s){this.position=t.clone(),this.params=s,this.points=[this.position.clone()],this.prevY=t.y}derivatives(t,s,a){const{a:n,b:i,c:l}=this.params;return[-s-a,t+n*s,i+a*(t-l)]}jacobianApply(t,s,a,n,i,l){const{a:d,c:o}=this.params;return[-i-l,n+d*i,a*n+(t-o)*l]}step(t=1){const s=this.dt*t,{x:a,y:n,z:i}=this.position,[l,d,o]=this.derivatives(a,n,i),[h,p,x]=this.derivatives(a+.5*s*l,n+.5*s*d,i+.5*s*o),[P,f,j]=this.derivatives(a+.5*s*h,n+.5*s*p,i+.5*s*x),[R,v,m]=this.derivatives(a+s*P,n+s*f,i+s*j);this.position.x+=s/6*(l+2*h+2*P+R),this.position.y+=s/6*(d+2*p+2*f+v),this.position.z+=s/6*(o+2*x+2*j+m),this.points.push(this.position.clone());const M=this.perturbation.x,E=this.perturbation.y,k=this.perturbation.z,[T,w,g]=this.jacobianApply(this.position.x,this.position.y,this.position.z,M,E,k);if(this.perturbation.x+=T*s,this.perturbation.y+=w*s,this.perturbation.z+=g*s,this.stepsSinceRenorm++,this.stepsSinceRenorm>=this.RENORM_INTERVAL){const b=this.perturbation.length();if(b>0&&isFinite(b)){this.lyapunovSum+=Math.log(b),this.lyapunovSteps++,this.perturbation.divideScalar(b);const y=this.lyapunovSteps*this.RENORM_INTERVAL*this.dt;this.lyapunovExponent=this.lyapunovSum/y}this.stepsSinceRenorm=0}return this.prevY<0&&this.position.y>=0&&this.points.length>100&&(this.poincarePoints.push([this.position.x,this.position.z]),this.poincarePoints.length>this.MAX_POINCARE&&(this.poincarePoints=this.poincarePoints.slice(-this.MAX_POINCARE))),this.prevY=this.position.y,this.position.clone()}reset(t=new L(1,1,1)){this.position=t.clone(),this.points=[this.position.clone()],this.perturbation.set(1,0,0),this.lyapunovSum=0,this.lyapunovSteps=0,this.lyapunovExponent=0,this.stepsSinceRenorm=0,this.prevY=t.y,this.poincarePoints=[]}updateParams(t){this.params={...this.params,...t}}trimTrail(t){this.points.length>t&&(this.points=this.points.slice(-t))}getSpeed(){if(this.points.length<2)return 0;const t=this.points[this.points.length-1],s=this.points[this.points.length-2];return t.distanceTo(s)}getParams(){return{...this.params}}}const we=({position:r=[0,0,0],scale:t=.5,initialCondition:s=[1,1,1],isSecondary:a=!1,lastPosRef:n})=>{const i=u.useRef(null),{isPlaying:l,speed:d,trailLength:o,rosslerParams:h,_resetCounter:p,colorTheme:x,showLyapunov:P,setLyapunovExponent:f,showPoincare:j,currentSystem:R}=C(),v=A[x],m=u.useMemo(()=>{const g=new L(...s);return new Pe(g,h)},[s[0],s[1],s[2],h.a,h.b,h.c]);u.useEffect(()=>{m.reset(new L(...s))},[p]),u.useEffect(()=>{m.updateParams(h)},[h,m]),u.useEffect(()=>(a||(window.__chaosLabSystem=m,window.__chaosLabSystemType="rossler"),()=>{!a&&window.__chaosLabSystem===m&&(window.__chaosLabSystem=null)}),[m,a]);const M=u.useRef([]),E=u.useRef(0);U(()=>{if(!l)return;m.step(d*.5),m.trimTrail(o);const g=m.points,b=[];for(let y=0;y<g.length;y++)b.push(new L(g[y].x*t,g[y].y*t,g[y].z*t));if(M.current=b,n&&g.length>0){const y=g[g.length-1];n.current=y.clone()}!a&&R==="rossler"&&(P||j)&&(E.current++,E.current%30===0&&f(m.lyapunovExponent))});const k=a?v.trailHue2:v.trailHue1,T=k+.25,w=new V().setHSL(k+.15,1,.8);return e.jsxs("group",{ref:i,position:r,children:[e.jsx(re,{points:M.current,hueStart:k,hueEnd:T,lineWidth:2.5,glowIntensity:.5}),m.points.length>0&&(()=>{const g=m.points[m.points.length-1];return e.jsxs("mesh",{position:[g.x*t,g.y*t,g.z*t],children:[e.jsx("sphereGeometry",{args:[.05,12,12]}),e.jsx("meshBasicMaterial",{color:w,transparent:!0,opacity:.9})]})})()]})};class Re{points=[];positions=[];state;params;dt=.005;pertState={theta1:1e-6,theta2:0,omega1:0,omega2:0};lyapunovSum=0;lyapunovSteps=0;lyapunovExponent=0;RENORM_INTERVAL=20;stepsSinceRenorm=0;prevTheta2=0;poincarePoints=[];MAX_POINCARE=5e3;constructor(t={theta1:Math.PI/2,theta2:Math.PI/2,omega1:0,omega2:0},s){this.state={...t},this.params=s,this.prevTheta2=t.theta2;const a=this.calculatePositions();this.positions=[a],this.points=[new L(a.p2.x,a.p2.y,0)]}calculatePositions(){const{length1:t,length2:s}=this.params,{theta1:a,theta2:n}=this.state,i=new le(t*Math.sin(a),-t*Math.cos(a)),l=new le(i.x+s*Math.sin(n),i.y-s*Math.cos(n));return{p1:i,p2:l}}accelerations(t){const{mass1:s,mass2:a,length1:n,length2:i,gravity:l,damping:d}=this.params,{theta1:o,theta2:h,omega1:p,omega2:x}=t,P=s,f=a,j=n,R=i,v=l,m=Math.cos(o-h),M=Math.sin(o-h),E=Math.sin(o),k=Math.sin(h),T=(P+f)*j-f*j*m*m,w=R/j*T,g=-f*j*p*p*M*m+f*v*k*m+f*R*x*x*M-(P+f)*v*E,b=-f*R*x*x*M*m+(P+f)*v*E*m+(P+f)*j*p*p*M-(P+f)*v*k;let y=g/T,S=b/w;return y-=d*p,S-=d*x,{alpha1:y,alpha2:S}}stateDerivative(t){const{alpha1:s,alpha2:a}=this.accelerations(t);return{theta1:t.omega1,theta2:t.omega2,omega1:s,omega2:a}}addStates(t,s,a){return{theta1:t.theta1+s.theta1*a,theta2:t.theta2+s.theta2*a,omega1:t.omega1+s.omega1*a,omega2:t.omega2+s.omega2*a}}step(t=1){const s=this.dt*t,a=this.stateDerivative(this.state),n=this.stateDerivative(this.addStates(this.state,a,.5*s)),i=this.stateDerivative(this.addStates(this.state,n,.5*s)),l=this.stateDerivative(this.addStates(this.state,i,s));this.state.theta1+=s/6*(a.theta1+2*n.theta1+2*i.theta1+l.theta1),this.state.theta2+=s/6*(a.theta2+2*n.theta2+2*i.theta2+l.theta2),this.state.omega1+=s/6*(a.omega1+2*n.omega1+2*i.omega1+l.omega1),this.state.omega2+=s/6*(a.omega2+2*n.omega2+2*i.omega2+l.omega2);const d=this.calculatePositions();this.positions.push(d),this.points.push(new L(d.p2.x,d.p2.y,0));const o=1e-7,h={theta1:this.state.theta1+this.pertState.theta1*o,theta2:this.state.theta2+this.pertState.theta2*o,omega1:this.state.omega1+this.pertState.omega1*o,omega2:this.state.omega2+this.pertState.omega2*o},p=this.stateDerivative(this.state),x=this.stateDerivative(h);if(this.pertState.theta1+=(x.theta1-p.theta1)/o*s,this.pertState.theta2+=(x.theta2-p.theta2)/o*s,this.pertState.omega1+=(x.omega1-p.omega1)/o*s,this.pertState.omega2+=(x.omega2-p.omega2)/o*s,this.stepsSinceRenorm++,this.stepsSinceRenorm>=this.RENORM_INTERVAL){const j=Math.sqrt(this.pertState.theta1**2+this.pertState.theta2**2+this.pertState.omega1**2+this.pertState.omega2**2);if(j>0&&isFinite(j)){this.lyapunovSum+=Math.log(j),this.lyapunovSteps++,this.pertState.theta1/=j,this.pertState.theta2/=j,this.pertState.omega1/=j,this.pertState.omega2/=j;const R=this.lyapunovSteps*this.RENORM_INTERVAL*this.dt;this.lyapunovExponent=this.lyapunovSum/R}this.stepsSinceRenorm=0}const P=(this.state.theta2%(2*Math.PI)+2*Math.PI)%(2*Math.PI);return(this.prevTheta2%(2*Math.PI)+2*Math.PI)%(2*Math.PI)>Math.PI&&P<=Math.PI&&P<1&&this.points.length>100&&(this.poincarePoints.push([this.state.theta1,this.state.omega1]),this.poincarePoints.length>this.MAX_POINCARE&&(this.poincarePoints=this.poincarePoints.slice(-this.MAX_POINCARE))),this.prevTheta2=this.state.theta2,new L(d.p2.x,d.p2.y,0)}reset(t={theta1:Math.PI/2,theta2:Math.PI/2,omega1:0,omega2:0}){this.state={...t};const s=this.calculatePositions();this.positions=[s],this.points=[new L(s.p2.x,s.p2.y,0)],this.pertState={theta1:1e-6,theta2:0,omega1:0,omega2:0},this.lyapunovSum=0,this.lyapunovSteps=0,this.lyapunovExponent=0,this.stepsSinceRenorm=0,this.prevTheta2=t.theta2,this.poincarePoints=[]}updateParams(t){this.params={...this.params,...t}}trimTrail(t){this.points.length>t&&(this.points=this.points.slice(-t),this.positions=this.positions.slice(-t))}getSpeed(){if(this.points.length<2)return 0;const t=this.points[this.points.length-1],s=this.points[this.points.length-2];return t.distanceTo(s)}getCurrentPositions(){return this.positions[this.positions.length-1]}getState(){return{...this.state}}}const ke=({position:r=[0,0,0],scale:t=1,initialCondition:s={theta1:Math.PI/2,theta2:Math.PI/2,omega1:0,omega2:0},isSecondary:a=!1,lastPosRef:n})=>{const i=u.useRef(null),{isPlaying:l,speed:d,trailLength:o,doublePendulumParams:h,_resetCounter:p,colorTheme:x,showLyapunov:P,setLyapunovExponent:f,showPoincare:j,currentSystem:R}=C(),v=A[x],m=u.useMemo(()=>new Re(s,h),[s.theta1,s.theta2,s.omega1,s.omega2,h.mass1,h.mass2,h.length1,h.length2,h.gravity,h.damping]);u.useEffect(()=>{m.reset(s)},[p]),u.useEffect(()=>{m.updateParams(h)},[h,m]),u.useEffect(()=>(a||(window.__chaosLabSystem=m,window.__chaosLabSystemType="doublePendulum"),()=>{!a&&window.__chaosLabSystem===m&&(window.__chaosLabSystem=null)}),[m,a]);const M=u.useRef([]),E=u.useRef(0);U(()=>{if(!l)return;m.step(d*2),m.trimTrail(o);const I=m.points,B=[];for(let N=0;N<I.length;N++)B.push(new L(I[N].x*t,I[N].y*t,0));if(M.current=B,n&&I.length>0){const N=I[I.length-1];n.current=new L(N.x,N.y,0)}!a&&R==="doublePendulum"&&(P||j)&&(E.current++,E.current%30===0&&f(m.lyapunovExponent))});const k=m.positions.length>0?m.getCurrentPositions():{p1:{x:0,y:0},p2:{x:0,y:0}},T=a?v.trailHue2:v.trailHue1,w=T+.2,g=new V(v.textMuted),b=new V().setHSL(T,.8,.6),y=new V().setHSL(T+.1,.8,.7),S=[k.p1.x*t,k.p1.y*t,0],F=[k.p2.x*t,k.p2.y*t,0];return e.jsxs("group",{ref:i,position:r,children:[e.jsx(re,{points:M.current,hueStart:T,hueEnd:w,lineWidth:1.8,glowIntensity:.4}),e.jsxs("line",{children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",args:[new Float32Array([0,0,0,...S]),3]})}),e.jsx("lineBasicMaterial",{color:g,linewidth:2,transparent:!0,opacity:.6})]}),e.jsxs("line",{children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",args:[new Float32Array([...S,...F]),3]})}),e.jsx("lineBasicMaterial",{color:g,linewidth:2,transparent:!0,opacity:.6})]}),e.jsxs("mesh",{position:[0,0,0],children:[e.jsx("sphereGeometry",{args:[.03,12,12]}),e.jsx("meshBasicMaterial",{color:"#ffffff",transparent:!0,opacity:.7})]}),e.jsxs("mesh",{position:[S[0],S[1],S[2]],children:[e.jsx("sphereGeometry",{args:[.06*Math.sqrt(h.mass1),16,16]}),e.jsx("meshBasicMaterial",{color:b})]}),e.jsxs("mesh",{position:[F[0],F[1],F[2]],children:[e.jsx("sphereGeometry",{args:[.06*Math.sqrt(h.mass2),16,16]}),e.jsx("meshBasicMaterial",{color:y})]})]})},Z=600,Q=80,Me=.02,Ee=()=>{const r=u.useRef(null),{colorTheme:t}=C(),s=A[t],{positions:a,sizes:n}=u.useMemo(()=>{const l=new Float32Array(Z*3),d=new Float32Array(Z);for(let o=0;o<Z;o++)l[o*3]=(Math.random()-.5)*Q,l[o*3+1]=(Math.random()-.5)*Q,l[o*3+2]=(Math.random()-.5)*Q,d[o]=Math.random()*1.5+.3;return{positions:l,sizes:d}},[]),i=u.useMemo(()=>new V(s.starColor),[s.starColor]);return U(({clock:l})=>{if(!r.current)return;const d=l.getElapsedTime()*Me;r.current.rotation.y=d,r.current.rotation.x=d*.3}),e.jsxs("points",{ref:r,children:[e.jsxs("bufferGeometry",{children:[e.jsx("bufferAttribute",{attach:"attributes-position",args:[a,3]}),e.jsx("bufferAttribute",{attach:"attributes-size",args:[n,1]})]}),e.jsx("pointsMaterial",{color:i,size:.08,transparent:!0,opacity:.4,sizeAttenuation:!0,depthWrite:!1,blending:se})]})},he={lorenz:{position:[10,10,10],fov:60},rossler:{position:[8,8,8],fov:60},doublePendulum:{position:[0,0,5],fov:50}},Ce=()=>{const{autoRotate:r,currentSystem:t}=C();return e.jsx(ye,{enablePan:!0,enableZoom:!0,enableRotate:!0,autoRotate:r&&t!=="doublePendulum",autoRotateSpeed:2,maxPolarAngle:Math.PI,minDistance:2,maxDistance:20})},Te=({posA:r,posB:t})=>{const{setDivergence:s,sideBySideMode:a}=C();return U(()=>{if(!a)return;const n=r.current,i=t.current;n&&i&&s(n.distanceTo(i))}),null},J=({position:r=[0,0,0],initialCondition:t,colorHue:s=.6,isSecondary:a=!1,lastPosRef:n})=>{const{currentSystem:i}=C();switch(i){case"lorenz":return e.jsx(je,{position:r,initialCondition:t||[1,1,1],colorHue:s,isSecondary:a,lastPosRef:n});case"rossler":return e.jsx(we,{position:r,initialCondition:t||[1,1,1],colorHue:s,isSecondary:a,lastPosRef:n});case"doublePendulum":return e.jsx(ke,{position:r,initialCondition:t||{theta1:Math.PI/2,theta2:Math.PI/2,omega1:0,omega2:0},colorHue:s,isSecondary:a,lastPosRef:n});default:return null}},Ne=()=>{const{sideBySideMode:r,currentSystem:t,initialOffset:s,colorTheme:a}=C(),n=A[a],i=u.useRef(null),l=u.useRef(null);return e.jsxs(e.Fragment,{children:[e.jsx("ambientLight",{intensity:.2}),e.jsx("directionalLight",{position:[10,10,5],intensity:.3}),e.jsx(Ee,{}),t==="doublePendulum"&&e.jsx(xe,{args:[10,10],position:[0,-3,0],cellColor:"#222233",sectionColor:"#333355",fadeDistance:25,fadeStrength:1}),r?e.jsxs(e.Fragment,{children:[e.jsx(J,{position:[0,0,0],initialCondition:t==="doublePendulum"?{theta1:Math.PI/2,theta2:Math.PI/2,omega1:0,omega2:0}:[1,1,1],colorHue:n.trailHue1,isSecondary:!1,lastPosRef:i}),e.jsx(J,{position:[0,0,0],initialCondition:t==="doublePendulum"?{theta1:Math.PI/2+s,theta2:Math.PI/2,omega1:0,omega2:0}:[1+s,1,1],colorHue:n.trailHue2,isSecondary:!0,lastPosRef:l}),e.jsx(Te,{posA:i,posB:l})]}):e.jsx(J,{}),e.jsx(Ce,{})]})},Le=()=>{const{currentSystem:r,colorTheme:t}=C(),s=A[t],a=he[r]??he.lorenz;return e.jsx("div",{style:{width:"100vw",height:"100vh",background:s.bg},role:"img","aria-label":`3D visualization of ${r==="lorenz"?"Lorenz attractor":r==="rossler"?"RÃ¶ssler attractor":"double pendulum"} chaos system`,children:e.jsxs(be,{camera:{position:a.position,fov:a.fov},gl:{antialias:!0,alpha:!0,powerPreference:"high-performance",preserveDrawingBuffer:!0},children:[e.jsx("color",{attach:"background",args:[s.bg]}),e.jsx("fog",{attach:"fog",args:[s.bg,30,60]}),e.jsx(u.Suspense,{fallback:null,children:e.jsx(Ne,{})})]})})},ze={classic:"ðŸŒŒ Classic",neon:"ðŸ’œ Neon",blueprint:"ðŸ“ Blueprint",terminal:"ðŸ’» Terminal"},Fe={lorenz:"ðŸ¦‹ Lorenz",rossler:"ðŸŒ€ RÃ¶ssler",doublePendulum:"âš¡ Pendulum"},Ae=()=>{const[r,t]=u.useState(!1),[s,a]=u.useState(!1);u.useEffect(()=>{const c=()=>a(window.innerWidth<=768);return c(),window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]);const{currentSystem:n,setCurrentSystem:i,isPlaying:l,setIsPlaying:d,speed:o,setSpeed:h,trailLength:p,setTrailLength:x,sideBySideMode:P,setSideBySideMode:f,initialOffset:j,setInitialOffset:R,autoRotate:v,setAutoRotate:m,currentPreset:M,setCurrentPreset:E,colorTheme:k,setColorTheme:T,lorenzParams:w,setLorenzParams:g,rosslerParams:b,setRosslerParams:y,doublePendulumParams:S,setDoublePendulumParams:F,resetSimulation:I,showLyapunov:B,setShowLyapunov:N,showBifurcation:G,setShowBifurcation:$,showPoincare:_,setShowPoincare:Y,showParameterSpace:D,setShowParameterSpace:H}=C(),z=A[k],W=c=>{const K=ce[n].find(ge=>ge.name===c);if(K){switch(n){case"lorenz":g(K.params);break;case"rossler":y(K.params);break;case"doublePendulum":F(K.params);break}E(c)}},pe=c=>{i(c),E(null)},ne=c=>c>=.01?c.toFixed(3):c.toExponential(1),me=()=>{switch(n){case"lorenz":return e.jsxs("div",{className:"parameter-group",role:"group","aria-label":"Lorenz system parameters",children:[e.jsx("h4",{children:"Lorenz Parameters"}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"sigma-slider",children:["Ïƒ (sigma): ",w.sigma.toFixed(2)]}),e.jsx("input",{id:"sigma-slider",type:"range",min:"0.1",max:"30",step:"0.1",value:w.sigma,"aria-valuemin":.1,"aria-valuemax":30,"aria-valuenow":w.sigma,"aria-label":`Sigma: ${w.sigma.toFixed(2)}`,onChange:c=>g({sigma:parseFloat(c.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"rho-slider",children:["Ï (rho): ",w.rho.toFixed(2)]}),e.jsx("input",{id:"rho-slider",type:"range",min:"0.1",max:"50",step:"0.1",value:w.rho,"aria-valuemin":.1,"aria-valuemax":50,"aria-valuenow":w.rho,"aria-label":`Rho: ${w.rho.toFixed(2)}`,onChange:c=>g({rho:parseFloat(c.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"beta-slider",children:["Î² (beta): ",w.beta.toFixed(3)]}),e.jsx("input",{id:"beta-slider",type:"range",min:"0.1",max:"10",step:"0.01",value:w.beta,"aria-valuemin":.1,"aria-valuemax":10,"aria-valuenow":w.beta,"aria-label":`Beta: ${w.beta.toFixed(3)}`,onChange:c=>g({beta:parseFloat(c.target.value)})})]})]});case"rossler":return e.jsxs("div",{className:"parameter-group",role:"group","aria-label":"RÃ¶ssler system parameters",children:[e.jsx("h4",{children:"RÃ¶ssler Parameters"}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"a-slider",children:["a: ",b.a.toFixed(3)]}),e.jsx("input",{id:"a-slider",type:"range",min:"0.01",max:"1.0",step:"0.01",value:b.a,"aria-label":`Parameter a: ${b.a.toFixed(3)}`,onChange:c=>y({a:parseFloat(c.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"b-slider",children:["b: ",b.b.toFixed(3)]}),e.jsx("input",{id:"b-slider",type:"range",min:"0.01",max:"1.0",step:"0.01",value:b.b,"aria-label":`Parameter b: ${b.b.toFixed(3)}`,onChange:c=>y({b:parseFloat(c.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"c-slider",children:["c: ",b.c.toFixed(2)]}),e.jsx("input",{id:"c-slider",type:"range",min:"1.0",max:"20.0",step:"0.1",value:b.c,"aria-label":`Parameter c: ${b.c.toFixed(2)}`,onChange:c=>y({c:parseFloat(c.target.value)})})]})]});case"doublePendulum":return e.jsxs("div",{className:"parameter-group",role:"group","aria-label":"Double pendulum parameters",children:[e.jsx("h4",{children:"Pendulum Parameters"}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"mass1-slider",children:["Mass 1: ",S.mass1.toFixed(2)]}),e.jsx("input",{id:"mass1-slider",type:"range",min:"0.1",max:"5.0",step:"0.1",value:S.mass1,"aria-label":`Mass 1: ${S.mass1.toFixed(2)}`,onChange:c=>F({mass1:parseFloat(c.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"mass2-slider",children:["Mass 2: ",S.mass2.toFixed(2)]}),e.jsx("input",{id:"mass2-slider",type:"range",min:"0.1",max:"5.0",step:"0.1",value:S.mass2,"aria-label":`Mass 2: ${S.mass2.toFixed(2)}`,onChange:c=>F({mass2:parseFloat(c.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"len1-slider",children:["Length 1: ",S.length1.toFixed(2)]}),e.jsx("input",{id:"len1-slider",type:"range",min:"0.2",max:"2.0",step:"0.1",value:S.length1,"aria-label":`Length 1: ${S.length1.toFixed(2)}`,onChange:c=>F({length1:parseFloat(c.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"len2-slider",children:["Length 2: ",S.length2.toFixed(2)]}),e.jsx("input",{id:"len2-slider",type:"range",min:"0.2",max:"2.0",step:"0.1",value:S.length2,"aria-label":`Length 2: ${S.length2.toFixed(2)}`,onChange:c=>F({length2:parseFloat(c.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"gravity-slider",children:["Gravity: ",S.gravity.toFixed(2)]}),e.jsx("input",{id:"gravity-slider",type:"range",min:"1.0",max:"20.0",step:"0.1",value:S.gravity,"aria-label":`Gravity: ${S.gravity.toFixed(2)}`,onChange:c=>F({gravity:parseFloat(c.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"damping-slider",children:["Damping: ",S.damping.toFixed(3)]}),e.jsx("input",{id:"damping-slider",type:"range",min:"0.0",max:"0.2",step:"0.005",value:S.damping,"aria-label":`Damping: ${S.damping.toFixed(3)}`,onChange:c=>F({damping:parseFloat(c.target.value)})})]})]});default:return null}};return e.jsxs("aside",{className:`controls ${r?"collapsed":""} ${s?"mobile":""}`,role:"region","aria-label":"Simulation controls",style:{"--panel-bg":z.panelBg,"--panel-border":z.panelBorder,"--text-color":z.text,"--text-muted":z.textMuted,"--accent":z.accent,"--accent2":z.accent2,"--heading":z.heading,"--param-color":z.paramColor},children:[e.jsx("button",{className:"controls-toggle",onClick:()=>t(!r),"aria-label":r?"Show controls":"Hide controls","aria-expanded":!r,children:r?"âš™ï¸":"âœ•"}),!r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{id:"system-heading",children:"Chaos System"}),e.jsx("div",{className:"system-tabs",role:"tablist","aria-labelledby":"system-heading",children:["lorenz","rossler","doublePendulum"].map(c=>e.jsx("button",{role:"tab","aria-selected":n===c,"aria-label":`Select ${c==="doublePendulum"?"Double Pendulum":c} system`,className:`system-tab ${n===c?"active":""}`,onClick:()=>pe(c),children:Fe[c]},c))})]}),e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{children:"Simulation"}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{onClick:()=>d(!l),className:`play-button ${l?"playing":"paused"}`,"aria-label":l?"Pause simulation":"Play simulation",children:l?"â¸ Pause":"â–¶ Play"}),e.jsx("button",{onClick:I,className:"reset-button","aria-label":"Reset simulation",children:"ðŸ”„ Reset"})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"speed-slider",children:["Speed: ",o.toFixed(1),"x"]}),e.jsx("input",{id:"speed-slider",type:"range",min:"0.1",max:"5.0",step:"0.1",value:o,"aria-label":`Simulation speed: ${o.toFixed(1)}x`,onChange:c=>h(parseFloat(c.target.value))})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"trail-slider",children:["Trail: ",p,p>3e3&&e.jsx("span",{className:"warn",children:" âš ï¸ High"})]}),e.jsx("input",{id:"trail-slider",type:"range",min:"100",max:"5000",step:"100",value:p,"aria-label":`Trail length: ${p} points`,onChange:c=>x(parseInt(c.target.value))})]})]}),e.jsxs("div",{className:"control-section butterfly-section",children:[e.jsx("h3",{children:"ðŸ¦‹ Butterfly Effect"}),e.jsx("div",{className:"checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:P,"aria-label":"Enable butterfly mode: show two systems with tiny initial difference",onChange:c=>{f(c.target.checked),c.target.checked&&I()}}),"Enable Butterfly Mode"]})}),P&&e.jsxs("div",{className:"slider-group offset-slider",children:[e.jsxs("label",{htmlFor:"offset-slider",children:["Initial Offset: ",e.jsx("span",{className:"offset-value",children:ne(j)})]}),e.jsx("input",{id:"offset-slider",type:"range",min:"-6",max:"-0.5",step:"0.1",value:Math.log10(j),"aria-label":`Initial offset between systems: ${ne(j)}`,onChange:c=>{R(Math.pow(10,parseFloat(c.target.value))),I()}}),e.jsxs("div",{className:"offset-labels","aria-hidden":"true",children:[e.jsx("span",{children:"Tiny"}),e.jsx("span",{children:"Large"})]})]})]}),e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{children:"View"}),n!=="doublePendulum"&&e.jsx("div",{className:"checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:v,"aria-label":"Auto-rotate camera around the attractor",onChange:c=>m(c.target.checked)}),"Auto Rotate"]})})]}),e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{id:"theme-heading",children:"Theme"}),e.jsx("div",{className:"theme-grid",role:"radiogroup","aria-labelledby":"theme-heading",children:Object.keys(A).map(c=>e.jsx("button",{role:"radio","aria-checked":k===c,"aria-label":`${c} theme`,className:`theme-btn ${k===c?"active":""}`,onClick:()=>T(c),style:{"--tbg":A[c].bg,"--taccent":A[c].accent},children:ze[c]},c))})]}),e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{children:"Presets"}),e.jsx("div",{className:"preset-chips",role:"group","aria-label":"Parameter presets",children:ce[n].map(c=>e.jsx("button",{className:`preset-chip ${M===c.name?"active":""}`,onClick:()=>W(c.name),"aria-label":`${c.name}: ${c.description}`,"aria-pressed":M===c.name,children:c.name},c.name))})]}),me(),n!=="doublePendulum"&&e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{children:"ðŸ”¬ Analysis"}),e.jsxs("div",{className:"analysis-buttons",children:[e.jsx("button",{className:`analysis-btn ${B?"active":""}`,onClick:()=>N(!B),"aria-pressed":B,"aria-label":"Toggle Lyapunov exponent indicator",children:"Î» Lyapunov"}),e.jsx("button",{className:`analysis-btn ${G?"active":""}`,onClick:()=>$(!G),"aria-pressed":G,"aria-label":"Toggle bifurcation diagram",children:"ðŸ“ˆ Bifurcation"}),e.jsx("button",{className:`analysis-btn ${_?"active":""}`,onClick:()=>Y(!_),"aria-pressed":_,"aria-label":"Toggle PoincarÃ© section",children:"â—Ž PoincarÃ©"}),e.jsx("button",{className:`analysis-btn ${D?"active":""}`,onClick:()=>H(!D),"aria-pressed":D,"aria-label":"Toggle parameter space explorer",children:"ðŸ—ºï¸ Param Space"})]})]})]})]})},Ie={lorenz:{title:"Lorenz Attractor",description:"The Lorenz attractor is a set of chaotic solutions of the Lorenz system, discovered by Edward Lorenz in 1963. It arises from a simplified model of atmospheric convection.",equations:["dx/dt = Ïƒ(y - x)","dy/dt = x(Ï - z) - y","dz/dt = xy - Î²z"],whatMakesChaotic:'The system is chaotic because small changes in initial conditions lead to drastically different outcomes over time. This is the famous "butterfly effect" â€” a butterfly flapping its wings in Brazil could theoretically cause a tornado in Texas.',parameters:{"Ïƒ (sigma)":"Prandtl number â€” relates viscosity to thermal conductivity","Ï (rho)":"Rayleigh number â€” measures temperature difference","Î² (beta)":"Geometric factor related to the size of convection cells"}},rossler:{title:"RÃ¶ssler Attractor",description:"The RÃ¶ssler attractor is another chaotic system, developed by Otto RÃ¶ssler in 1976. It was designed to be simpler than the Lorenz system while still exhibiting chaotic behavior.",equations:["dx/dt = -y - z","dy/dt = x + ay","dz/dt = b + z(x - c)"],whatMakesChaotic:"The RÃ¶ssler system shows how even simple nonlinear equations can produce chaos. The attractor has a characteristic spiral structure that folds back on itself, creating sensitive dependence on initial conditions.",parameters:{a:"Controls the rate of expansion in the y direction",b:"Constant term that affects the z component",c:"Controls the folding and stretching of the attractor"}},doublePendulum:{title:"Double Pendulum",description:"A double pendulum consists of two pendulums attached end to end. Despite being a deterministic system governed by well-known physical laws, it exhibits chaotic motion.",equations:["Complex coupled differential equations","involving angles Î¸â‚, Î¸â‚‚ and their","angular velocities Ï‰â‚, Ï‰â‚‚"],whatMakesChaotic:"The chaos arises from the nonlinear coupling between the two pendulums. Small changes in the initial angles or velocities can lead to completely different trajectories. This demonstrates that chaos can emerge from simple, everyday systems.",parameters:{"Mass 1, Mass 2":"Masses of the first and second pendulum bobs","Length 1, Length 2":"Lengths of the first and second pendulum arms",Gravity:"Gravitational acceleration",Damping:"Energy loss due to friction (0 = no damping)"}}},_e=()=>{const{currentSystem:r,showInfoPanel:t,setShowInfoPanel:s}=C();if(!t)return e.jsx("button",{className:"info-toggle collapsed",onClick:()=>s(!0),"aria-label":"Show system information panel",children:"â„¹ï¸"});const a=Ie[r];return e.jsxs("aside",{className:"info-panel",role:"complementary","aria-label":"System information",children:[e.jsxs("div",{className:"info-header",children:[e.jsx("h2",{children:a.title}),e.jsx("button",{className:"info-close",onClick:()=>s(!1),"aria-label":"Close information panel",children:"âœ•"})]}),e.jsxs("div",{className:"info-content",children:[e.jsxs("section",{"aria-labelledby":"info-overview",children:[e.jsx("h3",{id:"info-overview",children:"Overview"}),e.jsx("p",{children:a.description})]}),e.jsxs("section",{"aria-labelledby":"info-equations",children:[e.jsx("h3",{id:"info-equations",children:"Equations"}),e.jsx("div",{className:"equations",role:"math","aria-label":"System equations",children:a.equations.map((n,i)=>e.jsx("div",{className:"equation",children:n},i))})]}),e.jsxs("section",{"aria-labelledby":"info-chaos",children:[e.jsx("h3",{id:"info-chaos",children:"What Makes It Chaotic?"}),e.jsx("p",{children:a.whatMakesChaotic})]}),e.jsxs("section",{"aria-labelledby":"info-params",children:[e.jsx("h3",{id:"info-params",children:"Parameters"}),e.jsx("dl",{className:"parameters",children:Object.entries(a.parameters).map(([n,i])=>e.jsxs("div",{className:"parameter",children:[e.jsx("dt",{children:e.jsx("strong",{children:n})}),e.jsx("dd",{children:i})]},n))})]}),e.jsxs("section",{"aria-labelledby":"info-tips",children:[e.jsx("h3",{id:"info-tips",children:"Tips"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Try the side-by-side mode to see how small changes create big differences"}),e.jsx("li",{children:"Experiment with different presets to explore various behaviors"}),e.jsx("li",{children:"Adjust the trail length to see more or less of the trajectory"}),e.jsx("li",{children:"Use the speed control to slow down and observe the motion closely"})]})]})]})]})},q=[{title:"Welcome to Chaos Lab! ðŸ¦‹",description:"Explore the beautiful world of chaos theory through interactive visualizations. Watch as simple equations create complex, unpredictable patterns."},{title:"Try Side-by-Side Mode",description:"Enable 'Butterfly Mode' to see the butterfly effect in action. Two systems with tiny differences will evolve completely differently!",highlight:"side-by-side"},{title:"Experiment with Parameters",description:"Adjust the sliders to see how small changes in parameters can dramatically alter the behavior. Try the preset configurations for interesting starting points.",highlight:"parameters"},{title:"Explore Different Systems",description:"Switch between Lorenz Attractor, RÃ¶ssler Attractor, and Double Pendulum to see different types of chaotic behavior.",highlight:"systems"},{title:"Learn More",description:"Click the info button (â„¹ï¸) to learn about the mathematics and physics behind each system. Ready to explore chaos?",highlight:"info"}],De=()=>{const[r,t]=u.useState(!1),[s,a]=u.useState(0),{setSideBySideMode:n,setShowInfoPanel:i}=C(),l=u.useRef(null);u.useEffect(()=>{localStorage.getItem("chaosLabTutorial")||t(!0)},[]),u.useEffect(()=>{r&&l.current&&l.current.focus()},[r,s]);const d=u.useCallback(()=>{localStorage.setItem("chaosLabTutorial","completed"),t(!1)},[]),o=u.useCallback(()=>{s<q.length-1?a(s+1):d()},[s,d]),h=u.useCallback(()=>{switch(q[s].highlight){case"side-by-side":n(!0);break;case"info":i(!0);break}o()},[s,o,n,i]),p=u.useCallback(f=>{f.key==="Escape"?d():(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),o())},[d,o]);if(!r)return null;const x=q[s],P=s===q.length-1;return e.jsx("div",{className:"quick-start-overlay",role:"dialog","aria-modal":"true","aria-label":"Quick start tutorial",onKeyDown:p,children:e.jsxs("div",{className:"quick-start-modal",ref:l,tabIndex:-1,children:[e.jsxs("div",{className:"quick-start-header",children:[e.jsx("h2",{id:"qs-title",children:x.title}),e.jsx("button",{className:"quick-start-close",onClick:d,"aria-label":"Close tutorial",children:"âœ•"})]}),e.jsxs("div",{className:"quick-start-content",children:[e.jsx("p",{id:"qs-desc",children:x.description}),e.jsx("div",{className:"quick-start-progress",role:"progressbar","aria-valuenow":s+1,"aria-valuemin":1,"aria-valuemax":q.length,"aria-label":`Step ${s+1} of ${q.length}`,children:q.map((f,j)=>e.jsx("div",{className:`progress-dot ${j<=s?"active":""}`,"aria-hidden":"true"},j))})]}),e.jsxs("div",{className:"quick-start-actions",children:[e.jsx("button",{className:"quick-start-skip",onClick:d,children:"Skip Tutorial"}),e.jsx("button",{className:"quick-start-next",onClick:x.highlight?h:o,"aria-describedby":"qs-desc",children:P?"Let's Explore!":"Next"})]})]})})},Be=()=>{const{sideBySideMode:r,divergence:t,colorTheme:s}=C(),a=A[s];if(!r)return null;const n=Math.log10(Math.max(t,1e-4)),i=Math.min(1,Math.max(0,(n+4)/6)),l=Math.round(i*100),d=(1-i)*120,o=t<.001?t.toExponential(2):t.toFixed(3);return e.jsxs("div",{role:"meter","aria-label":"Divergence between the two systems","aria-valuenow":i,"aria-valuemin":0,"aria-valuemax":1,"aria-valuetext":`Divergence: ${o}`,style:{position:"absolute",bottom:80,left:"50%",transform:"translateX(-50%)",zIndex:200,pointerEvents:"none",textAlign:"center",fontFamily:"'Segoe UI', sans-serif"},children:[e.jsx("div",{style:{color:a.textMuted,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",marginBottom:6},children:"Divergence"}),e.jsx("div",{style:{width:200,height:6,background:`rgba(${a.bgRgb}, 0.7)`,borderRadius:3,overflow:"hidden",border:`1px solid ${a.panelBorder}`,backdropFilter:"blur(4px)"},children:e.jsx("div",{style:{width:`${l}%`,height:"100%",background:`hsl(${d}, 90%, 55%)`,borderRadius:3,transition:"width 0.1s ease, background 0.3s ease",boxShadow:`0 0 8px hsla(${d}, 90%, 55%, 0.6)`}})}),e.jsx("div",{style:{color:a.text,fontSize:"13px",marginTop:4,fontVariantNumeric:"tabular-nums",fontWeight:600,textShadow:`0 0 10px hsla(${d}, 90%, 55%, 0.5)`},children:o})]})},Oe=()=>{const{showLyapunov:r,lyapunovExponent:t,colorTheme:s}=C(),a=A[s];if(!r)return null;const i=(Math.max(-2,Math.min(3,t))+2)/5,l=(1-i)*120,d=Math.min(100,Math.max(5,i*100)),o=t>.1?"Chaotic":t>-.05?"Edge of Chaos":"Stable",h=t>.1?"ðŸ”´":t>-.05?"ðŸŸ¡":"ðŸŸ¢";return e.jsxs("div",{className:"lyapunov-indicator",role:"status","aria-label":`Lyapunov exponent: ${t.toFixed(3)}, system is ${o}`,"aria-live":"polite",style:{"--panel-bg":a.panelBg,"--panel-border":a.panelBorder,"--text":a.text,"--text-muted":a.textMuted,"--bar-hue":l},children:[e.jsxs("div",{className:"lyapunov-header",children:[e.jsx("span",{className:"lyapunov-label",children:"Î» (Lyapunov)"}),e.jsxs("span",{className:"lyapunov-status","aria-hidden":"true",children:[h," ",o]})]}),e.jsxs("div",{className:"lyapunov-value",style:{color:`hsl(${l}, 90%, 60%)`},children:["Î» = ",t.toFixed(3)]}),e.jsxs("div",{className:"lyapunov-bar-track",role:"meter","aria-valuenow":t,"aria-valuemin":-2,"aria-valuemax":3,"aria-label":"Lyapunov exponent",children:[e.jsx("div",{className:"lyapunov-bar-fill",style:{width:`${d}%`,background:`hsl(${l}, 85%, 50%)`,boxShadow:`0 0 10px hsla(${l}, 85%, 50%, 0.6)`}}),e.jsx("div",{className:"lyapunov-bar-zero","aria-hidden":"true"})]}),e.jsx("div",{className:"lyapunov-hint",children:"Measures how fast nearby paths diverge. Positive = chaos."})]})},$e=[{key:"Space",action:"Play / Pause simulation"},{key:"R",action:"Reset simulation"},{key:"1",action:"Switch to Lorenz attractor"},{key:"2",action:"Switch to RÃ¶ssler attractor"},{key:"3",action:"Switch to Double Pendulum"},{key:"S",action:"Toggle side-by-side (Butterfly) mode"},{key:"T",action:"Cycle through color themes"},{key:"P",action:"Screenshot current view"},{key:"L",action:"Copy share link to clipboard"},{key:"H / ?",action:"Toggle this help overlay"},{key:"Esc",action:"Close open dialogs"}],He=({isVisible:r,onClose:t})=>{const s=u.useRef(null);return u.useEffect(()=>{r&&s.current?.focus()},[r]),u.useEffect(()=>{if(!r)return;const a=n=>{(n.key==="Escape"||n.key==="h"||n.key==="H"||n.key==="?")&&(n.preventDefault(),t())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[r,t]),r?e.jsx("div",{className:"help-overlay",role:"dialog","aria-modal":"true","aria-label":"Keyboard shortcuts",onClick:t,children:e.jsxs("div",{className:"help-modal",ref:s,tabIndex:-1,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"help-header",children:[e.jsx("h2",{children:"âŒ¨ï¸ Keyboard Shortcuts"}),e.jsx("button",{className:"help-close",onClick:t,"aria-label":"Close help",children:"âœ•"})]}),e.jsx("div",{className:"help-grid",children:$e.map(({key:a,action:n})=>e.jsxs("div",{className:"help-row",children:[e.jsx("kbd",{className:"help-key",children:a}),e.jsx("span",{className:"help-action",children:n})]},a))}),e.jsxs("div",{className:"help-footer",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Mouse:"})," Drag to rotate Â· Scroll to zoom Â· Right-drag to pan"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Touch:"})," Drag to rotate Â· Pinch to zoom"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Right-click"})," canvas for quick actions"]})]})]})}):null};function qe(){const{currentSystem:r}=C();return u.useCallback(()=>{const s=document.querySelector("canvas");if(s)try{const a=r==="doublePendulum"?"pendulum":r,n=new Date().toISOString().split("T")[0],i=`chaos-lab-${a}-${n}.png`;s.toBlob(l=>{if(!l)return;const d=URL.createObjectURL(l),o=document.createElement("a");o.href=d,o.download=i,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(d)},"image/png")}catch(a){console.warn("Screenshot failed:",a)}},[r])}const Ge=new Set(["lorenz","rossler","doublePendulum"]),Ve=new Set(["classic","neon","blueprint","terminal"]);function de(){const r=C.getState(),t=new URLSearchParams;switch(t.set("sys",r.currentSystem),t.set("theme",r.colorTheme),t.set("speed",r.speed.toFixed(1)),t.set("trail",String(r.trailLength)),t.set("sbs",r.sideBySideMode?"1":"0"),r.sideBySideMode&&t.set("offset",r.initialOffset.toExponential(1)),r.currentSystem){case"lorenz":t.set("sigma",r.lorenzParams.sigma.toFixed(2)),t.set("rho",r.lorenzParams.rho.toFixed(2)),t.set("beta",r.lorenzParams.beta.toFixed(3));break;case"rossler":t.set("a",r.rosslerParams.a.toFixed(3)),t.set("b",r.rosslerParams.b.toFixed(3)),t.set("c",r.rosslerParams.c.toFixed(2));break;case"doublePendulum":t.set("m1",r.doublePendulumParams.mass1.toFixed(2)),t.set("m2",r.doublePendulumParams.mass2.toFixed(2)),t.set("l1",r.doublePendulumParams.length1.toFixed(2)),t.set("l2",r.doublePendulumParams.length2.toFixed(2)),t.set("g",r.doublePendulumParams.gravity.toFixed(2)),t.set("damp",r.doublePendulumParams.damping.toFixed(3));break}return"#"+t.toString()}function Ue(r){if(!r||r.length<2)return!1;try{const t=new URLSearchParams(r.slice(1)),s=C.getState(),a=t.get("sys");if(a&&Ge.has(a))s.setCurrentSystem(a);else return!1;const n=t.get("theme");n&&Ve.has(n)&&s.setColorTheme(n);const i=parseFloat(t.get("speed")||"");i>0&&i<=5&&s.setSpeed(i);const l=parseInt(t.get("trail")||"");if(l>=100&&l<=5e3&&s.setTrailLength(l),t.get("sbs")==="1"){s.setSideBySideMode(!0);const o=parseFloat(t.get("offset")||"");o>0&&o<1&&s.setInitialOffset(o)}switch(a){case"lorenz":{const o=parseFloat(t.get("sigma")||""),h=parseFloat(t.get("rho")||""),p=parseFloat(t.get("beta")||"");o>0&&s.setLorenzParams({sigma:o}),h>0&&s.setLorenzParams({rho:h}),p>0&&s.setLorenzParams({beta:p});break}case"rossler":{const o=parseFloat(t.get("a")||""),h=parseFloat(t.get("b")||""),p=parseFloat(t.get("c")||"");o>0&&s.setRosslerParams({a:o}),h>0&&s.setRosslerParams({b:h}),p>0&&s.setRosslerParams({c:p});break}case"doublePendulum":{const o=parseFloat(t.get("m1")||""),h=parseFloat(t.get("m2")||""),p=parseFloat(t.get("l1")||""),x=parseFloat(t.get("l2")||""),P=parseFloat(t.get("g")||""),f=parseFloat(t.get("damp")||"");o>0&&s.setDoublePendulumParams({mass1:o}),h>0&&s.setDoublePendulumParams({mass2:h}),p>0&&s.setDoublePendulumParams({length1:p}),x>0&&s.setDoublePendulumParams({length2:x}),P>0&&s.setDoublePendulumParams({gravity:P}),f>=0&&s.setDoublePendulumParams({damping:f});break}}return!0}catch{return!1}}function ue(){return window.location.origin+window.location.pathname+de()}function We(){const r=u.useRef(!1);u.useEffect(()=>{r.current||(r.current=!0,window.location.hash&&Ue(window.location.hash))},[]);const{currentSystem:t,colorTheme:s,speed:a,trailLength:n,sideBySideMode:i,initialOffset:l,lorenzParams:d,rosslerParams:o,doublePendulumParams:h}=C();u.useEffect(()=>{const p=setTimeout(()=>{window.history.replaceState(null,"",de())},500);return()=>clearTimeout(p)},[t,s,a,n,i,l,d,o,h])}const ee=["classic","neon","blueprint","terminal"],te=["lorenz","rossler","doublePendulum"];function Ke(r){const t=qe();u.useEffect(()=>{const s=a=>{const n=a.target.tagName;if(n==="INPUT"||n==="TEXTAREA"||n==="SELECT"||a.ctrlKey||a.metaKey||a.altKey)return;const i=C.getState();switch(a.key){case" ":a.preventDefault(),i.setIsPlaying(!i.isPlaying);break;case"r":case"R":i.resetSimulation();break;case"1":i.setCurrentSystem(te[0]),i.setCurrentPreset(null);break;case"2":i.setCurrentSystem(te[1]),i.setCurrentPreset(null);break;case"3":i.setCurrentSystem(te[2]),i.setCurrentPreset(null);break;case"s":case"S":i.setSideBySideMode(!i.sideBySideMode),i.sideBySideMode||i.resetSimulation();break;case"t":case"T":{const l=ee.indexOf(i.colorTheme),d=ee[(l+1)%ee.length];i.setColorTheme(d);break}case"h":case"H":case"?":r();break;case"p":case"P":t();break;case"l":case"L":try{navigator.clipboard.writeText(ue())}catch{window.prompt("Share this URL:",ue())}break;case"Escape":i.showBifurcation?i.setShowBifurcation(!1):i.showPoincare?i.setShowPoincare(!1):i.showParameterSpace&&i.setShowParameterSpace(!1);break}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[r,t])}const Xe=u.lazy(()=>ae(()=>import("./BifurcationDiagram-BsnEZeAf.js"),__vite__mapDeps([0,1,2])).then(r=>({default:r.BifurcationDiagram}))),Ye=u.lazy(()=>ae(()=>import("./PoincareSection-D6XrfZiz.js"),__vite__mapDeps([3,1,4])).then(r=>({default:r.PoincareSection}))),Ze=u.lazy(()=>ae(()=>import("./ParameterSpace-BwCudLVF.js"),__vite__mapDeps([5,1,6])).then(r=>({default:r.ParameterSpace})));function Qe(){const r=C(t=>t.setIsPlaying);u.useEffect(()=>{const t=window.matchMedia("(prefers-reduced-motion: reduce)");t.matches&&r(!1);const s=a=>{a.matches&&r(!1)};return t.addEventListener("change",s),()=>t.removeEventListener("change",s)},[r])}function Je(){const{colorTheme:r,currentSystem:t}=C(),s=A[r],[a,n]=u.useState(!1),i=u.useCallback(()=>n(d=>!d),[]);Qe(),Ke(i),We();const l=t==="lorenz"?"Lorenz Attractor":t==="rossler"?"RÃ¶ssler Attractor":"Double Pendulum";return e.jsxs("div",{className:"app",style:{"--bg":s.bg,"--text":s.text,"--accent":s.accent},children:[e.jsx("a",{href:"#controls-region",className:"skip-link",children:"Skip to controls"}),e.jsxs("div",{className:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true",children:["Now viewing: ",l]}),e.jsx("main",{children:e.jsx(Le,{})}),e.jsx(_e,{}),e.jsx("div",{id:"controls-region",children:e.jsx(Ae,{})}),e.jsx(Be,{}),e.jsx(Oe,{}),e.jsxs(u.Suspense,{fallback:null,children:[e.jsx(Xe,{}),e.jsx(Ye,{}),e.jsx(Ze,{})]}),e.jsx(He,{isVisible:a,onClose:i}),e.jsx(De,{}),e.jsxs("div",{className:"title-overlay","aria-hidden":"true",children:[e.jsx("h1",{children:"Chaos Lab"}),e.jsx("p",{children:"Interactive Chaos Theory Visualizer"})]}),e.jsx("div",{className:"instructions","aria-hidden":"true",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Mouse:"})," Drag to rotate Â· Scroll to zoom Â· Right-drag to pan",e.jsx("br",{}),e.jsx("strong",{children:"Touch:"})," Drag to rotate Â· Pinch to zoom"]})})]})}ve.createRoot(document.getElementById("root")).render(e.jsx(u.StrictMode,{children:e.jsx(Je,{})}));export{A as T,C as u};
