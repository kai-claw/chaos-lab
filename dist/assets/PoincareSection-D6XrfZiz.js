import{r as l,j as f}from"./three-vendor-B6sVHfeA.js";import{u as W,T as $}from"./index-GD9bX1Nu.js";const g=500,u=400,G=()=>{const{showPoincare:i,setShowPoincare:z,colorTheme:N,currentSystem:m,isPlaying:P}=W(),x=$[N],j=l.useRef(null),d=l.useRef(0),v=l.useRef(0),A=l.useCallback(()=>{switch(m){case"lorenz":return{x:"x",y:"y",title:"Lorenz PoincarÃ© Section (z maxima)"};case"rossler":return{x:"x",y:"z",title:"RÃ¶ssler PoincarÃ© Section (y = 0 crossing)"};case"doublePendulum":return{x:"Î¸â‚",y:"Ï‰â‚",title:"Pendulum PoincarÃ© Section (Î¸â‚‚ = 0)"};default:return{x:"x",y:"y",title:"PoincarÃ© Section"}}},[m]),o=l.useCallback(()=>{const C=j.current;if(!C||!i)return;const e=C.getContext("2d");if(!e)return;const T=window.__chaosLabSystem;if(!T||!T.poincarePoints)return;const c=T.poincarePoints;if(c.length===v.current&&c.length>0){d.current=requestAnimationFrame(o);return}if(v.current=c.length,e.fillStyle="#0a0a18",e.fillRect(0,0,g,u),c.length===0){e.fillStyle="rgba(255,255,255,0.3)",e.font="13px system-ui, sans-serif",e.textAlign="center",e.fillText("Collecting points... let the simulation run.",g/2,u/2),d.current=requestAnimationFrame(o);return}let r=1/0,h=-1/0,a=1/0,p=-1/0;for(const[t,s]of c)t<r&&(r=t),t>h&&(h=t),s<a&&(a=s),s>p&&(p=s);const I=h-r||1,X=p-a||1,k=I*.1,E=X*.1;r-=k,h+=k,a-=E,p+=E;const n=40,b=g-2*n,y=u-2*n,Y=t=>n+(t-r)/(h-r)*b,H=t=>n+y-(t-a)/(p-a)*y;e.strokeStyle="rgba(255,255,255,0.06)",e.lineWidth=1;for(let t=0;t<=5;t++){const s=n+t/5*b,S=n+t/5*y;e.beginPath(),e.moveTo(s,n),e.lineTo(s,n+y),e.stroke(),e.beginPath(),e.moveTo(n,S),e.lineTo(n+b,S),e.stroke()}const w=c.length;for(let t=0;t<w;t++){const[s,S]=c[t],_=Y(s),q=H(S),L=.15+t/w*.7,M=x.trailHue1*360;e.fillStyle=`hsla(${M}, 85%, 60%, ${L})`,e.beginPath(),e.arc(_,q,2,0,Math.PI*2),e.fill()}const R=A();e.fillStyle="rgba(255,255,255,0.5)",e.font="11px system-ui, sans-serif",e.textAlign="center";for(let t=0;t<=4;t++){const s=r+t/4*(h-r);e.fillText(s.toFixed(1),n+t/4*b,u-6)}e.textAlign="right";for(let t=0;t<=4;t++){const s=a+t/4*(p-a);e.fillText(s.toFixed(1),n-4,n+y-t/4*y+4)}e.fillStyle="rgba(255,255,255,0.6)",e.font="12px system-ui, sans-serif",e.textAlign="center",e.fillText(R.x,g/2,u-18),e.save(),e.translate(14,u/2),e.rotate(-Math.PI/2),e.fillText(R.y,0,0),e.restore(),e.fillStyle="rgba(255,255,255,0.3)",e.font="10px system-ui, sans-serif",e.textAlign="right",e.fillText(`${w} points`,g-n,n-6),P&&(d.current=requestAnimationFrame(o))},[i,m,P,x,A]);if(l.useEffect(()=>(i&&(v.current=0,o()),()=>{d.current&&cancelAnimationFrame(d.current)}),[i,o]),l.useEffect(()=>{i&&P&&o()},[P,i,o]),!i)return null;const F=A();return f.jsxs("div",{className:"poincare-overlay",style:{"--panel-bg":x.panelBg,"--panel-border":x.panelBorder,"--text":x.text,"--accent":x.accent},children:[f.jsxs("div",{className:"poincare-header",children:[f.jsxs("h3",{children:["ðŸŽ¯ ",F.title]}),f.jsx("button",{className:"poincare-close",onClick:()=>z(!1),children:"âœ•"})]}),f.jsx("div",{className:"poincare-canvas-wrap",children:f.jsx("canvas",{ref:j,width:g,height:u,className:"poincare-canvas"})}),f.jsxs("p",{className:"poincare-hint",children:["Points appear where the trajectory crosses a specific plane in phase space.",m==="lorenz"&&" Each dot marks a local maximum of z.",m==="rossler"&&" Each dot marks where y crosses zero (ascending).",m==="doublePendulum"&&" Each dot marks where Î¸â‚‚ passes through zero."]})]})};export{G as PoincareSection};
