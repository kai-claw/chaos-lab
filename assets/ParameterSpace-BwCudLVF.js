import{r as x,j as i}from"./three-vendor-B6sVHfeA.js";import{u as te,T as Se}from"./index-GD9bX1Nu.js";const ae=500,se=400,Re=()=>{const{showParameterSpace:j,setShowParameterSpace:O,colorTheme:re,currentSystem:p,setLorenzParams:ne,setRosslerParams:le,resetSimulation:ie,setCurrentSystem:U}=te(),M=Se[re],W=x.useRef(null),F=x.useRef(null),B=x.useRef(!1),V=x.useRef(0),[oe,G]=x.useState(!1),[ce,fe]=x.useState(0),R=te.getState(),P=x.useCallback(()=>p==="lorenz"?{xLabel:"Ïƒ (sigma)",yLabel:"Ï (rho)",xMin:1,xMax:30,yMin:1,yMax:50,xSteps:120,ySteps:100,title:"Lorenz Parameter Space (Lyapunov)",currentX:R.lorenzParams.sigma,currentY:R.lorenzParams.rho}:p==="rossler"?{xLabel:"a",yLabel:"c",xMin:.05,xMax:.5,yMin:1,yMax:20,xSteps:100,ySteps:100,title:"RÃ¶ssler Parameter Space (Lyapunov)",currentX:R.rosslerParams.a,currentY:R.rosslerParams.c}:null,[p,R.lorenzParams,R.rosslerParams]),D=x.useCallback(()=>{const t=W.current,a=P();if(!t||!a)return;const e=t.getContext("2d");if(!e)return;const s=e,l=t.width,r=t.height;s.fillStyle="#0a0a18",s.fillRect(0,0,l,r);const{xMin:u,xMax:$,yMin:K,yMax:he,xSteps:T,ySteps:C}=a;G(!0);let z=0;const me=5,ue=500,de=300,m=.01;function Q(){for(let Z=0;Z<me&&z<C;Z++,z++){const w=K+z/C*(he-K);for(let L=0;L<T;L++){const N=u+L/T*($-u);let n=1,o=1,c=1,d=1,y=0,g=0,ee=0,q=0;for(let f=0;f<ue;f++){let b,S,v;if(p==="lorenz"?(b=N*(o-n),S=n*(w-c)-o,v=n*o-8/3*c):(b=-o-c,S=n+N*o,v=.2+c*(n-w)),n+=b*m,o+=S*m,c+=v*m,Math.abs(n)>1e6){n=1,o=1,c=1;break}}for(let f=0;f<de;f++){let b,S,v,H,I,_;if(p==="lorenz"?(b=N*(o-n),S=n*(w-c)-o,v=n*o-8/3*c,H=N*(y-d),I=(w-c)*d-y-n*g,_=o*d+n*y-8/3*g):(b=-o-c,S=n+N*o,v=.2+c*(n-w),H=-y-g,I=d+N*y,_=c*d+(n-w)*g),n+=b*m,o+=S*m,c+=v*m,d+=H*m,y+=I*m,g+=_*m,Math.abs(n)>1e6)break;if(f%10===9){const k=Math.sqrt(d*d+y*y+g*g);k>0&&isFinite(k)&&(ee+=Math.log(k),q++,d/=k,y/=k,g/=k)}}const A=q>0?ee/(q*10*m):0;let E,X,Y;if(A>.1){const f=Math.min(1,A/3);E=180+75*f,X=30+180*f,Y=20}else if(A>-.05)E=180,X=200,Y=40;else{const f=Math.min(1,Math.abs(A)/5);E=10,X=30+100*(1-f),Y=80+150*(1-f)}const ye=Math.floor(L/T*l),Me=Math.floor(r-(z+1)/C*r),ge=Math.ceil(l/T)+1,be=Math.ceil(r/C)+1;s.fillStyle=`rgb(${E},${X},${Y})`,s.fillRect(ye,Me,ge,be)}}fe(Math.round(z/C*100)),z<C?V.current=requestAnimationFrame(Q):(B.current=!0,G(!1),xe(s,l,r,a))}Q()},[p,P]),xe=(t,a,e,s)=>{t.fillStyle="rgba(255,255,255,0.4)",t.font="10px system-ui, sans-serif",t.textAlign="center";for(let r=0;r<=5;r++){const u=s.xMin+r/5*(s.xMax-s.xMin);t.fillText(u.toFixed(1),r/5*a,e-4)}t.textAlign="left";for(let r=0;r<=5;r++){const u=s.yMin+r/5*(s.yMax-s.yMin);t.fillText(u.toFixed(1),4,e-r/5*e+4)}const l=14;t.font="10px system-ui, sans-serif",t.textAlign="left",t.fillStyle="rgb(255, 210, 20)",t.fillRect(a-130,l,10,10),t.fillStyle="rgba(255,255,255,0.5)",t.fillText("Chaotic (Î» > 0)",a-116,l+9),t.fillStyle="rgb(10, 130, 230)",t.fillRect(a-130,l+16,10,10),t.fillStyle="rgba(255,255,255,0.5)",t.fillText("Stable (Î» < 0)",a-116,l+25)},J=x.useCallback(()=>{const t=F.current,a=P();if(!t||!a)return;const e=t.getContext("2d");if(!e)return;e.clearRect(0,0,t.width,t.height);const s=(a.currentX-a.xMin)/(a.xMax-a.xMin)*t.width,l=t.height-(a.currentY-a.yMin)/(a.yMax-a.yMin)*t.height;e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=1,e.setLineDash([3,3]),e.beginPath(),e.moveTo(s,0),e.lineTo(s,t.height),e.stroke(),e.beginPath(),e.moveTo(0,l),e.lineTo(t.width,l),e.stroke(),e.setLineDash([]),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=2,e.beginPath(),e.arc(s,l,6,0,Math.PI*2),e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.8)",e.font="bold 11px system-ui, sans-serif",e.textAlign=s>t.width/2?"right":"left";const r=s>t.width/2?s-10:s+10;e.fillText(`${a.xLabel.split(" ")[0]}=${a.currentX.toFixed(1)}, ${a.yLabel.split(" ")[0]}=${a.currentY.toFixed(1)}`,r,l-10)},[P]);x.useEffect(()=>(j&&!B.current&&D(),()=>{V.current&&cancelAnimationFrame(V.current)}),[j,D]),x.useEffect(()=>{j&&J()},[j,J]),x.useEffect(()=>{B.current=!1,j&&D()},[p]);const pe=t=>{const a=F.current,e=P();if(!a||!e)return;const s=a.getBoundingClientRect(),l=t.clientX-s.left,r=t.clientY-s.top,u=e.xMin+l/s.width*(e.xMax-e.xMin),$=e.yMin+(1-r/s.height)*(e.yMax-e.yMin);p==="lorenz"?(U("lorenz"),ne({sigma:Math.round(u*10)/10,rho:Math.round($*10)/10})):p==="rossler"&&(U("rossler"),le({a:Math.round(u*100)/100,c:Math.round($*10)/10})),ie()};if(!j)return null;const h=P();return h?i.jsxs("div",{className:"paramspace-overlay",style:{"--panel-bg":M.panelBg,"--panel-border":M.panelBorder,"--text":M.text,"--accent":M.accent},children:[i.jsxs("div",{className:"paramspace-header",children:[i.jsxs("h3",{children:["ðŸ—ºï¸ ",h.title]}),i.jsx("button",{className:"paramspace-close",onClick:()=>O(!1),children:"âœ•"})]}),i.jsxs("div",{className:"paramspace-canvas-wrap",children:[i.jsx("canvas",{ref:W,width:ae,height:se,className:"paramspace-canvas"}),i.jsx("canvas",{ref:F,width:ae,height:se,className:"paramspace-canvas-overlay",onClick:pe,title:"Click to set parameters"}),oe&&i.jsx("div",{className:"paramspace-progress",children:i.jsx("div",{className:"paramspace-progress-bar",style:{width:`${ce}%`}})})]}),i.jsxs("p",{className:"paramspace-hint",children:["Click anywhere to jump to those parameters. Red/yellow = chaotic, blue = stable.",p==="lorenz"&&` X: Ïƒ (${h.xMin}â€“${h.xMax}), Y: Ï (${h.yMin}â€“${h.yMax}), Î² fixed at 8/3.`,p==="rossler"&&` X: a (${h.xMin}â€“${h.xMax}), Y: c (${h.yMin}â€“${h.yMax}), b fixed at 0.2.`]})]}):i.jsxs("div",{className:"paramspace-overlay",style:{"--panel-bg":M.panelBg,"--panel-border":M.panelBorder,"--text":M.text,"--accent":M.accent},children:[i.jsxs("div",{className:"paramspace-header",children:[i.jsx("h3",{children:"ðŸ—ºï¸ Parameter Space"}),i.jsx("button",{className:"paramspace-close",onClick:()=>O(!1),children:"âœ•"})]}),i.jsx("p",{className:"paramspace-hint",children:"Parameter space exploration is available for Lorenz and RÃ¶ssler systems."})]})};export{Re as ParameterSpace};
