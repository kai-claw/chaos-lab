import{r as p,j as i}from"./three-vendor-BMWzMgmY.js";import{u as U,T as ve}from"./index-BlOp_DQ5.js";const se=500,re=400,Ce=()=>{const{showParameterSpace:j,setShowParameterSpace:Y,colorTheme:le,currentSystem:x,setLorenzParams:ne,setRosslerParams:ie,resetSimulation:oe,setCurrentSystem:W}=U(),M=ve[le],G=p.useRef(null),F=p.useRef(null),B=p.useRef(!1),V=p.useRef(0),[ce,J]=p.useState(!1),[fe,pe]=p.useState(0),D=U(e=>e.lorenzParams),q=U(e=>e.rosslerParams),R=p.useCallback(()=>x==="lorenz"?{xLabel:"Ïƒ (sigma)",yLabel:"Ï (rho)",xMin:1,xMax:30,yMin:1,yMax:50,xSteps:120,ySteps:100,title:"Lorenz Parameter Space (Lyapunov)",currentX:D.sigma,currentY:D.rho}:x==="rossler"?{xLabel:"a",yLabel:"c",xMin:.05,xMax:.5,yMin:1,yMax:20,xSteps:100,ySteps:100,title:"RÃ¶ssler Parameter Space (Lyapunov)",currentX:q.a,currentY:q.c}:null,[x,D,q]),H=p.useCallback(()=>{const e=G.current,a=R();if(!e||!a)return;const t=e.getContext("2d");if(!t)return;const s=t,n=e.width,r=e.height;s.fillStyle="#0a0a18",s.fillRect(0,0,n,r);const{xMin:u,xMax:N,yMin:Z,yMax:me,xSteps:$,ySteps:C}=a;J(!0);let w=0;const ue=5,de=500,ye=300,m=.01;function ee(){for(let te=0;te<ue&&w<C;te++,w++){const P=Z+w/C*(me-Z);for(let T=0;T<$;T++){const k=u+T/$*(N-u);let l=1,o=1,c=1,d=1,y=0,b=0,ae=0,I=0;for(let f=0;f<de;f++){let g,S,v;if(x==="lorenz"?(g=k*(o-l),S=l*(P-c)-o,v=l*o-8/3*c):(g=-o-c,S=l+k*o,v=.2+c*(l-P)),l+=g*m,o+=S*m,c+=v*m,Math.abs(l)>1e6){l=1,o=1,c=1;break}}for(let f=0;f<ye;f++){let g,S,v,_,K,O;if(x==="lorenz"?(g=k*(o-l),S=l*(P-c)-o,v=l*o-8/3*c,_=k*(y-d),K=(P-c)*d-y-l*b,O=o*d+l*y-8/3*b):(g=-o-c,S=l+k*o,v=.2+c*(l-P),_=-y-b,K=d+k*y,O=c*d+(l-P)*b),l+=g*m,o+=S*m,c+=v*m,d+=_*m,y+=K*m,b+=O*m,Math.abs(l)>1e6)break;if(f%10===9){const z=Math.sqrt(d*d+y*y+b*b);z>0&&isFinite(z)&&(ae+=Math.log(z),I++,d/=z,y/=z,b/=z)}}const L=I>0?ae/(I*10*m):0;let A,E,X;if(L>.1){const f=Math.min(1,L/3);A=180+75*f,E=30+180*f,X=20}else if(L>-.05)A=180,E=200,X=40;else{const f=Math.min(1,Math.abs(L)/5);A=10,E=30+100*(1-f),X=80+150*(1-f)}const Me=Math.floor(T/$*n),be=Math.floor(r-(w+1)/C*r),ge=Math.ceil(n/$)+1,Se=Math.ceil(r/C)+1;s.fillStyle=`rgb(${A},${E},${X})`,s.fillRect(Me,be,ge,Se)}}pe(Math.round(w/C*100)),w<C?V.current=requestAnimationFrame(ee):(B.current=!0,J(!1),xe(s,n,r,a))}ee()},[x,R]),xe=(e,a,t,s)=>{e.fillStyle="rgba(255,255,255,0.4)",e.font="10px system-ui, sans-serif",e.textAlign="center";for(let r=0;r<=5;r++){const u=s.xMin+r/5*(s.xMax-s.xMin);e.fillText(u.toFixed(1),r/5*a,t-4)}e.textAlign="left";for(let r=0;r<=5;r++){const u=s.yMin+r/5*(s.yMax-s.yMin);e.fillText(u.toFixed(1),4,t-r/5*t+4)}const n=14;e.font="10px system-ui, sans-serif",e.textAlign="left",e.fillStyle="rgb(255, 210, 20)",e.fillRect(a-130,n,10,10),e.fillStyle="rgba(255,255,255,0.5)",e.fillText("Chaotic (Î» > 0)",a-116,n+9),e.fillStyle="rgb(10, 130, 230)",e.fillRect(a-130,n+16,10,10),e.fillStyle="rgba(255,255,255,0.5)",e.fillText("Stable (Î» < 0)",a-116,n+25)},Q=p.useCallback(()=>{const e=F.current,a=R();if(!e||!a)return;const t=e.getContext("2d");if(!t)return;t.clearRect(0,0,e.width,e.height);const s=(a.currentX-a.xMin)/(a.xMax-a.xMin)*e.width,n=e.height-(a.currentY-a.yMin)/(a.yMax-a.yMin)*e.height;t.strokeStyle="rgba(255, 255, 255, 0.5)",t.lineWidth=1,t.setLineDash([3,3]),t.beginPath(),t.moveTo(s,0),t.lineTo(s,e.height),t.stroke(),t.beginPath(),t.moveTo(0,n),t.lineTo(e.width,n),t.stroke(),t.setLineDash([]),t.strokeStyle="rgba(255, 255, 255, 0.9)",t.lineWidth=2,t.beginPath(),t.arc(s,n,6,0,Math.PI*2),t.stroke(),t.fillStyle="rgba(255, 255, 255, 0.8)",t.font="bold 11px system-ui, sans-serif",t.textAlign=s>e.width/2?"right":"left";const r=s>e.width/2?s-10:s+10;t.fillText(`${a.xLabel.split(" ")[0]}=${a.currentX.toFixed(1)}, ${a.yLabel.split(" ")[0]}=${a.currentY.toFixed(1)}`,r,n-10)},[R]);p.useEffect(()=>(j&&!B.current&&H(),()=>{V.current&&cancelAnimationFrame(V.current)}),[j,H]),p.useEffect(()=>{j&&Q()},[j,Q]),p.useEffect(()=>{B.current=!1,j&&H()},[x]);const he=e=>{const a=F.current,t=R();if(!a||!t)return;const s=a.getBoundingClientRect(),n=e.clientX-s.left,r=e.clientY-s.top,u=t.xMin+n/s.width*(t.xMax-t.xMin),N=t.yMin+(1-r/s.height)*(t.yMax-t.yMin);x==="lorenz"?(W("lorenz"),ne({sigma:Math.round(u*10)/10,rho:Math.round(N*10)/10})):x==="rossler"&&(W("rossler"),ie({a:Math.round(u*100)/100,c:Math.round(N*10)/10})),oe()};if(!j)return null;const h=R();return h?i.jsxs("div",{className:"paramspace-overlay",role:"dialog","aria-label":h.title,"aria-modal":"false",onKeyDown:e=>{e.key==="Escape"&&Y(!1)},style:{"--panel-bg":M.panelBg,"--panel-border":M.panelBorder,"--text":M.text,"--accent":M.accent},children:[i.jsxs("div",{className:"paramspace-header",children:[i.jsxs("h3",{children:["ðŸ—ºï¸ ",h.title]}),i.jsx("button",{className:"paramspace-close",onClick:()=>Y(!1),"aria-label":"Close parameter space explorer",children:"âœ•"})]}),i.jsxs("div",{className:"paramspace-canvas-wrap",children:[i.jsx("canvas",{ref:G,width:se,height:re,className:"paramspace-canvas"}),i.jsx("canvas",{ref:F,width:se,height:re,className:"paramspace-canvas-overlay",onClick:he,title:"Click to set parameters"}),ce&&i.jsx("div",{className:"paramspace-progress",children:i.jsx("div",{className:"paramspace-progress-bar",style:{width:`${fe}%`}})})]}),i.jsxs("p",{className:"paramspace-hint",children:["Click anywhere to jump to those parameters. Red/yellow = chaotic, blue = stable.",x==="lorenz"&&` X: Ïƒ (${h.xMin}â€“${h.xMax}), Y: Ï (${h.yMin}â€“${h.yMax}), Î² fixed at 8/3.`,x==="rossler"&&` X: a (${h.xMin}â€“${h.xMax}), Y: c (${h.yMin}â€“${h.yMax}), b fixed at 0.2.`]})]}):i.jsxs("div",{className:"paramspace-overlay",style:{"--panel-bg":M.panelBg,"--panel-border":M.panelBorder,"--text":M.text,"--accent":M.accent},children:[i.jsxs("div",{className:"paramspace-header",children:[i.jsx("h3",{children:"ðŸ—ºï¸ Parameter Space"}),i.jsx("button",{className:"paramspace-close",onClick:()=>Y(!1),children:"âœ•"})]}),i.jsx("p",{className:"paramspace-hint",children:"Parameter space exploration is available for Lorenz and RÃ¶ssler systems."})]})};export{Ce as ParameterSpace};
