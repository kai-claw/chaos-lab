const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BifurcationDiagram-B0YfiTJ0.js","assets/three-vendor-BMWzMgmY.js","assets/BifurcationDiagram-7MOkXOt8.css","assets/PoincareSection-CS_UtGC0.js","assets/PoincareSection-Bu5ajD9c.css","assets/ParameterSpace-DBD9JeMb.js","assets/ParameterSpace-U0tBLzM4.css"])))=>i.map(i=>d[i]);
import{V as A,c as Ce,r as c,u as q,B as Y,L as de,A as ee,j as e,a as me,C as X,b as pe,d as Me,E as ke,e as Ee,G as Le,O as Ne,_ as ce,f as Ae}from"./three-vendor-BMWzMgmY.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=s(i);fetch(i.href,n)}})();class ze{points=[];position;params;dt=.01;perturbation=new A(1,0,0);lyapunovSum=0;lyapunovSteps=0;lyapunovExponent=0;RENORM_INTERVAL=10;stepsSinceRenorm=0;prevZ=0;prevDz=0;poincarePoints=[];MAX_POINCARE=5e3;constructor(t=new A(1,1,1),s){this.position=t.clone(),this.params=s,this.points=[this.position.clone()],this.prevZ=t.z}derivatives(t,s,r){const{sigma:i,rho:n,beta:o}=this.params;return[i*(s-t),t*(n-r)-s,t*s-o*r]}jacobianApply(t,s,r,i,n,o){const{sigma:u,rho:l,beta:h}=this.params;return[u*(n-i),(l-r)*i-n-t*o,s*i+t*n-h*o]}step(t=1){const s=this.dt*t,{x:r,y:i,z:n}=this.position,[o,u,l]=this.derivatives(r,i,n),[h,f,b]=this.derivatives(r+.5*s*o,i+.5*s*u,n+.5*s*l),[x,m,j]=this.derivatives(r+.5*s*h,i+.5*s*f,n+.5*s*b),[T,w,p]=this.derivatives(r+s*x,i+s*m,n+s*j);this.position.x+=s/6*(o+2*h+2*x+T),this.position.y+=s/6*(u+2*f+2*m+w),this.position.z+=s/6*(l+2*b+2*j+p),(!isFinite(this.position.x)||!isFinite(this.position.y)||!isFinite(this.position.z)||Math.abs(this.position.x)>1e6)&&this.position.set(1,1,1),this.points.push(this.position.clone());const P=this.perturbation.x,k=this.perturbation.y,C=this.perturbation.z,[E,g,M]=this.jacobianApply(this.position.x,this.position.y,this.position.z,P,k,C);if(this.perturbation.x+=E*s,this.perturbation.y+=g*s,this.perturbation.z+=M*s,this.stepsSinceRenorm++,this.stepsSinceRenorm>=this.RENORM_INTERVAL){const v=this.perturbation.length();if(v>0&&isFinite(v)){this.lyapunovSum+=Math.log(v),this.lyapunovSteps++,this.perturbation.divideScalar(v);const S=this.lyapunovSteps*this.RENORM_INTERVAL*this.dt;this.lyapunovExponent=this.lyapunovSum/S}this.stepsSinceRenorm=0}const y=this.position.z-this.prevZ;return this.prevDz>0&&y<=0&&this.points.length>100&&(this.poincarePoints.push([this.position.x,this.position.y]),this.poincarePoints.length>this.MAX_POINCARE&&this.poincarePoints.splice(0,this.poincarePoints.length-this.MAX_POINCARE)),this.prevDz=y,this.prevZ=this.position.z,this.position.clone()}reset(t=new A(1,1,1)){this.position=t.clone(),this.points=[this.position.clone()],this.perturbation.set(1,0,0),this.lyapunovSum=0,this.lyapunovSteps=0,this.lyapunovExponent=0,this.stepsSinceRenorm=0,this.prevZ=t.z,this.prevDz=0,this.poincarePoints=[]}updateParams(t){this.params={...this.params,...t}}trimTrail(t){this.points.length>t&&this.points.splice(0,this.points.length-t)}getSpeed(){if(this.points.length<2)return 0;const t=this.points[this.points.length-1],s=this.points[this.points.length-2];return t.distanceTo(s)}getParams(){return{...this.params}}}const F={classic:{bg:"#000010",bgRgb:"0,0,16",panelBg:"rgba(20, 20, 25, 0.95)",panelBorder:"rgba(255, 255, 255, 0.1)",text:"#cccccc",textMuted:"rgba(255,255,255,0.6)",accent:"#88ccff",accent2:"#aaffaa",heading:"#88ccff",paramColor:"#ffcc88",trailHue1:.55,trailHue2:.85,starColor:"#ffffff"},neon:{bg:"#000000",bgRgb:"0,0,0",panelBg:"rgba(10, 0, 20, 0.95)",panelBorder:"rgba(255, 0, 255, 0.25)",text:"#e0e0e0",textMuted:"rgba(255,255,255,0.5)",accent:"#ff00ff",accent2:"#00ffff",heading:"#ff44ff",paramColor:"#ffff00",trailHue1:.83,trailHue2:.5,starColor:"#ff88ff"},blueprint:{bg:"#0a1628",bgRgb:"10,22,40",panelBg:"rgba(15, 30, 60, 0.95)",panelBorder:"rgba(100, 160, 255, 0.3)",text:"#c0d8f0",textMuted:"rgba(192,216,240,0.6)",accent:"#4488ff",accent2:"#88bbff",heading:"#6699ff",paramColor:"#aaccff",trailHue1:.6,trailHue2:.58,starColor:"#4488ff"},terminal:{bg:"#000a00",bgRgb:"0,10,0",panelBg:"rgba(0, 15, 0, 0.95)",panelBorder:"rgba(0, 255, 0, 0.2)",text:"#00dd00",textMuted:"rgba(0,220,0,0.5)",accent:"#00ff00",accent2:"#88ff88",heading:"#00ff00",paramColor:"#44ff44",trailHue1:.33,trailHue2:.28,starColor:"#00ff00"}},V=[{name:"The Butterfly Effect",emoji:"ðŸ¦‹",description:"Two nearly identical universes diverge into completely different futures",system:"lorenz",params:{sigma:10,rho:28,beta:8/3},trailLength:2e3,speed:1,sideBySide:!0,offset:1e-6},{name:"The Strange Attractor",emoji:"ðŸŒ€",description:"The iconic Lorenz butterfly â€” a shape that never repeats, yet never escapes",system:"lorenz",params:{sigma:10,rho:28,beta:8/3},trailLength:4e3,speed:1.5,sideBySide:!1,offset:.001},{name:"Edge of Order",emoji:"âš–ï¸",description:"Right at the boundary where predictable behavior gives way to chaos",system:"lorenz",params:{sigma:10,rho:24.5,beta:8/3},trailLength:3e3,speed:.8,sideBySide:!1,offset:.001},{name:"The Spiral",emoji:"ðŸŒŠ",description:"The RÃ¶ssler attractor â€” simplicity breeds complexity in this elegant spiral",system:"rossler",params:{a:.2,b:.2,c:5.7},trailLength:3500,speed:1.2,sideBySide:!1,offset:.001},{name:"Period Doubling",emoji:"ðŸ”„",description:"Watch the RÃ¶ssler system trace a period-2 orbit â€” the route to chaos begins",system:"rossler",params:{a:.2,b:.2,c:3.5},trailLength:3e3,speed:1,sideBySide:!1,offset:.001},{name:"The Pendulum",emoji:"âš¡",description:"A simple double pendulum â€” deterministic laws, unpredictable motion",system:"doublePendulum",params:{mass1:1,mass2:1,length1:1,length2:1,gravity:9.81,damping:0},trailLength:2e3,speed:1,sideBySide:!1,offset:.001},{name:"Dual Pendulums",emoji:"ðŸ”€",description:"Two pendulums, almost identical â€” watch them dance apart",system:"doublePendulum",params:{mass1:1,mass2:1,length1:1,length2:1,gravity:9.81,damping:0},trailLength:1500,speed:1,sideBySide:!0,offset:1e-4}],z=Ce(a=>({currentSystem:"lorenz",setCurrentSystem:t=>a({currentSystem:t}),isPlaying:!0,setIsPlaying:t=>a({isPlaying:t}),speed:1,setSpeed:t=>a({speed:t}),trailLength:1e3,setTrailLength:t=>a({trailLength:t}),sideBySideMode:!1,setSideBySideMode:t=>a({sideBySideMode:t}),initialOffset:.001,setInitialOffset:t=>a({initialOffset:t}),divergence:0,setDivergence:t=>a({divergence:t}),colorTheme:"classic",setColorTheme:t=>a({colorTheme:t}),lorenzParams:{sigma:10,rho:28,beta:8/3},setLorenzParams:t=>a(s=>({lorenzParams:{...s.lorenzParams,...t}})),rosslerParams:{a:.2,b:.2,c:5.7},setRosslerParams:t=>a(s=>({rosslerParams:{...s.rosslerParams,...t}})),doublePendulumParams:{mass1:1,mass2:1,length1:1,length2:1,gravity:9.81,damping:0},setDoublePendulumParams:t=>a(s=>({doublePendulumParams:{...s.doublePendulumParams,...t}})),currentPreset:null,setCurrentPreset:t=>a({currentPreset:t}),showInfoPanel:!0,setShowInfoPanel:t=>a({showInfoPanel:t}),autoRotate:!1,setAutoRotate:t=>a({autoRotate:t}),_resetCounter:0,resetSimulation:()=>{a(t=>({_resetCounter:t._resetCounter+1,isPlaying:!1})),setTimeout(()=>a({isPlaying:!0}),100)},showPerformanceWarning:!1,setShowPerformanceWarning:t=>a({showPerformanceWarning:t}),showLyapunov:!1,setShowLyapunov:t=>a({showLyapunov:t}),lyapunovExponent:0,setLyapunovExponent:t=>a({lyapunovExponent:t}),showBifurcation:!1,setShowBifurcation:t=>a({showBifurcation:t}),showPoincare:!1,setShowPoincare:t=>a({showPoincare:t}),showParameterSpace:!1,setShowParameterSpace:t=>a({showParameterSpace:t}),cinematicCamera:!1,setCinematicCamera:t=>a({cinematicCamera:t}),chaosAutopilot:!1,setChaosAutopilot:t=>a({chaosAutopilot:t}),storyMode:!1,setStoryMode:t=>a({storyMode:t}),currentStoryIndex:0,setCurrentStoryIndex:t=>a({currentStoryIndex:t})})),ge={lorenz:[{name:"Classic Lorenz",description:"The original butterfly attractor",params:{sigma:10,rho:28,beta:8/3}},{name:"Edge of Chaos",description:"Parameters at the edge between order and chaos",params:{sigma:10,rho:24,beta:8/3}},{name:"Strange Attractor",description:"Different parameter set creating unique patterns",params:{sigma:12,rho:30,beta:2.5}}],rossler:[{name:"Classic RÃ¶ssler",description:"The standard RÃ¶ssler attractor parameters",params:{a:.2,b:.2,c:5.7}},{name:"Spiral Focus",description:"Creates tighter spiral patterns",params:{a:.1,b:.1,c:4}},{name:"Period Doubling",description:"Shows period-doubling route to chaos",params:{a:.15,b:.2,c:10}}],doublePendulum:[{name:"Equal Masses",description:"Two pendulums with equal mass and length",params:{mass1:1,mass2:1,length1:1,length2:1,gravity:9.81,damping:0}},{name:"Heavy Bottom",description:"Bottom pendulum twice as heavy",params:{mass1:1,mass2:2,length1:1,length2:1,gravity:9.81,damping:0}},{name:"With Damping",description:"Small damping showing energy dissipation",params:{mass1:1,mass2:1,length1:1,length2:1,gravity:9.81,damping:.05}}]},H=6e3,he=({points:a,hueStart:t,hueEnd:s,scale:r=1,flatZ:i=!1,glowIntensity:n=.6})=>{const o=c.useRef(null),u=c.useRef(null),l=c.useRef(null),h=c.useRef(null),{posBuffer:f,colorBuffer:b,glowColorBuffer:x}=c.useMemo(()=>({posBuffer:new Float32Array(H*3),colorBuffer:new Float32Array(H*3),glowColorBuffer:new Float32Array(H*3)}),[]);q(()=>{if(!l.current||!h.current)return;const T=Math.min(a.length,H);if(T<2){l.current.setDrawRange(0,0),h.current.setDrawRange(0,0);return}const w=Math.max(0,a.length-H),p=r;for(let g=0;g<T;g++){const M=a[w+g],y=g*3;f[y]=M.x*p,f[y+1]=M.y*p,f[y+2]=i?0:M.z*p;const v=g/(T-1),S=v*v,L=t+(s-t)*v,N=.85,R=.35+S*.45,I=(1-Math.abs(2*R-1))*N,U=(L%1+1)%1*6,_=I*(1-Math.abs(U%2-1)),B=R-I/2,te=Math.floor(U)%6;let O=0,W=0,D=0;switch(te){case 0:O=I,W=_;break;case 1:O=_,W=I;break;case 2:W=I,D=_;break;case 3:W=_,D=I;break;case 4:O=_,D=I;break;case 5:O=I,D=_;break}b[y]=(O+B)*S,b[y+1]=(W+B)*S,b[y+2]=(D+B)*S;const Z=S*n;x[y]=(O+B)*Z*1.5,x[y+1]=(W+B)*Z*1.5,x[y+2]=(D+B)*Z*1.5}const P=l.current.getAttribute("position"),k=l.current.getAttribute("color");P.set(f.subarray(0,T*3)),k.set(b.subarray(0,T*3)),P.needsUpdate=!0,k.needsUpdate=!0,l.current.setDrawRange(0,T);const C=h.current.getAttribute("position"),E=h.current.getAttribute("color");C.set(f.subarray(0,T*3)),E.set(x.subarray(0,T*3)),C.needsUpdate=!0,E.needsUpdate=!0,h.current.setDrawRange(0,T)}),c.useEffect(()=>{!l.current||!h.current||(l.current.setAttribute("position",new Y(new Float32Array(H*3),3)),l.current.setAttribute("color",new Y(new Float32Array(H*3),3)),l.current.setDrawRange(0,0),h.current.setAttribute("position",new Y(new Float32Array(H*3),3)),h.current.setAttribute("color",new Y(new Float32Array(H*3),3)),h.current.setDrawRange(0,0))},[]);const m=c.useMemo(()=>new de({vertexColors:!0,transparent:!0,opacity:1,depthWrite:!1,blending:ee}),[]),j=c.useMemo(()=>new de({vertexColors:!0,transparent:!0,opacity:.4,depthWrite:!1,blending:ee}),[]);return e.jsxs(e.Fragment,{children:[e.jsxs("primitive",{object:new me,ref:o,children:[e.jsx("bufferGeometry",{ref:l}),e.jsx("primitive",{object:m,attach:"material"})]}),e.jsxs("primitive",{object:new me,ref:u,children:[e.jsx("bufferGeometry",{ref:h}),e.jsx("primitive",{object:j,attach:"material"})]})]})},Fe=({position:a=[0,0,0],scale:t=.1,initialCondition:s=[1,1,1],isSecondary:r=!1,lastPosRef:i})=>{const n=c.useRef(null),{isPlaying:o,speed:u,trailLength:l,lorenzParams:h,_resetCounter:f,colorTheme:b,showLyapunov:x,setLyapunovExponent:m,showPoincare:j}=z(),T=F[b],w=c.useMemo(()=>{const g=new A(...s);return new ze(g,h)},[s[0],s[1],s[2],h.sigma,h.rho,h.beta]);c.useEffect(()=>{w.reset(new A(...s))},[f]),c.useEffect(()=>{w.updateParams(h)},[h,w]);const p=c.useRef(w);p.current=w,c.useEffect(()=>(r||(window.__chaosLabSystem=w,window.__chaosLabSystemType="lorenz"),()=>{!r&&window.__chaosLabSystem===w&&(window.__chaosLabSystem=null)}),[w,r]);const P=c.useRef(0);q(()=>{if(!o)return;w.step(u*.5),w.trimTrail(l);const g=w.points;if(i&&g.length>0){const M=g[g.length-1];i.current=M.clone()}!r&&(x||j)&&(P.current++,P.current%30===0&&m(w.lyapunovExponent))});const k=r?T.trailHue2:T.trailHue1,C=k+.2,E=new X().setHSL(k+.15,1,.7);return e.jsxs("group",{ref:n,position:a,children:[e.jsx(he,{points:w.points,hueStart:k,hueEnd:C,lineWidth:2.5,glowIntensity:.5,scale:t}),w.points.length>0&&(()=>{const g=w.points[w.points.length-1];return e.jsxs("mesh",{position:[g.x*t,g.y*t,g.z*t],children:[e.jsx("sphereGeometry",{args:[.04,12,12]}),e.jsx("meshBasicMaterial",{color:E,transparent:!0,opacity:.9})]})})()]})};class Ie{points=[];position;params;dt=.01;perturbation=new A(1,0,0);lyapunovSum=0;lyapunovSteps=0;lyapunovExponent=0;RENORM_INTERVAL=10;stepsSinceRenorm=0;prevY=0;poincarePoints=[];MAX_POINCARE=5e3;constructor(t=new A(1,1,1),s){this.position=t.clone(),this.params=s,this.points=[this.position.clone()],this.prevY=t.y}derivatives(t,s,r){const{a:i,b:n,c:o}=this.params;return[-s-r,t+i*s,n+r*(t-o)]}jacobianApply(t,s,r,i,n,o){const{a:u,c:l}=this.params;return[-n-o,i+u*n,r*i+(t-l)*o]}step(t=1){const s=this.dt*t,{x:r,y:i,z:n}=this.position,[o,u,l]=this.derivatives(r,i,n),[h,f,b]=this.derivatives(r+.5*s*o,i+.5*s*u,n+.5*s*l),[x,m,j]=this.derivatives(r+.5*s*h,i+.5*s*f,n+.5*s*b),[T,w,p]=this.derivatives(r+s*x,i+s*m,n+s*j);this.position.x+=s/6*(o+2*h+2*x+T),this.position.y+=s/6*(u+2*f+2*m+w),this.position.z+=s/6*(l+2*b+2*j+p),(!isFinite(this.position.x)||!isFinite(this.position.y)||!isFinite(this.position.z)||Math.abs(this.position.x)>1e6)&&this.position.set(1,1,1),this.points.push(this.position.clone());const P=this.perturbation.x,k=this.perturbation.y,C=this.perturbation.z,[E,g,M]=this.jacobianApply(this.position.x,this.position.y,this.position.z,P,k,C);if(this.perturbation.x+=E*s,this.perturbation.y+=g*s,this.perturbation.z+=M*s,this.stepsSinceRenorm++,this.stepsSinceRenorm>=this.RENORM_INTERVAL){const y=this.perturbation.length();if(y>0&&isFinite(y)){this.lyapunovSum+=Math.log(y),this.lyapunovSteps++,this.perturbation.divideScalar(y);const v=this.lyapunovSteps*this.RENORM_INTERVAL*this.dt;this.lyapunovExponent=this.lyapunovSum/v}this.stepsSinceRenorm=0}return this.prevY<0&&this.position.y>=0&&this.points.length>100&&(this.poincarePoints.push([this.position.x,this.position.z]),this.poincarePoints.length>this.MAX_POINCARE&&this.poincarePoints.splice(0,this.poincarePoints.length-this.MAX_POINCARE)),this.prevY=this.position.y,this.position.clone()}reset(t=new A(1,1,1)){this.position=t.clone(),this.points=[this.position.clone()],this.perturbation.set(1,0,0),this.lyapunovSum=0,this.lyapunovSteps=0,this.lyapunovExponent=0,this.stepsSinceRenorm=0,this.prevY=t.y,this.poincarePoints=[]}updateParams(t){this.params={...this.params,...t}}trimTrail(t){this.points.length>t&&this.points.splice(0,this.points.length-t)}getSpeed(){if(this.points.length<2)return 0;const t=this.points[this.points.length-1],s=this.points[this.points.length-2];return t.distanceTo(s)}getParams(){return{...this.params}}}const _e=({position:a=[0,0,0],scale:t=.5,initialCondition:s=[1,1,1],isSecondary:r=!1,lastPosRef:i})=>{const n=c.useRef(null),{isPlaying:o,speed:u,trailLength:l,rosslerParams:h,_resetCounter:f,colorTheme:b,showLyapunov:x,setLyapunovExponent:m,showPoincare:j,currentSystem:T}=z(),w=F[b],p=c.useMemo(()=>{const g=new A(...s);return new Ie(g,h)},[s[0],s[1],s[2],h.a,h.b,h.c]);c.useEffect(()=>{p.reset(new A(...s))},[f]),c.useEffect(()=>{p.updateParams(h)},[h,p]),c.useEffect(()=>(r||(window.__chaosLabSystem=p,window.__chaosLabSystemType="rossler"),()=>{!r&&window.__chaosLabSystem===p&&(window.__chaosLabSystem=null)}),[p,r]);const P=c.useRef(0);q(()=>{if(!o)return;p.step(u*.5),p.trimTrail(l);const g=p.points;if(i&&g.length>0){const M=g[g.length-1];i.current=M.clone()}!r&&T==="rossler"&&(x||j)&&(P.current++,P.current%30===0&&m(p.lyapunovExponent))});const k=r?w.trailHue2:w.trailHue1,C=k+.25,E=new X().setHSL(k+.15,1,.8);return e.jsxs("group",{ref:n,position:a,children:[e.jsx(he,{points:p.points,hueStart:k,hueEnd:C,lineWidth:2.5,glowIntensity:.5,scale:t}),p.points.length>0&&(()=>{const g=p.points[p.points.length-1];return e.jsxs("mesh",{position:[g.x*t,g.y*t,g.z*t],children:[e.jsx("sphereGeometry",{args:[.05,12,12]}),e.jsx("meshBasicMaterial",{color:E,transparent:!0,opacity:.9})]})})()]})};class De{points=[];positions=[];state;params;dt=.005;pertState={theta1:1e-6,theta2:0,omega1:0,omega2:0};lyapunovSum=0;lyapunovSteps=0;lyapunovExponent=0;RENORM_INTERVAL=20;stepsSinceRenorm=0;prevTheta2=0;poincarePoints=[];MAX_POINCARE=5e3;constructor(t={theta1:Math.PI/2,theta2:Math.PI/2,omega1:0,omega2:0},s){this.state={...t},this.params=s,this.prevTheta2=t.theta2;const r=this.calculatePositions();this.positions=[r],this.points=[new A(r.p2.x,r.p2.y,0)]}calculatePositions(){const{length1:t,length2:s}=this.params,{theta1:r,theta2:i}=this.state,n=new pe(t*Math.sin(r),-t*Math.cos(r)),o=new pe(n.x+s*Math.sin(i),n.y-s*Math.cos(i));return{p1:n,p2:o}}accelerations(t){const{mass1:s,mass2:r,length1:i,length2:n,gravity:o,damping:u}=this.params,{theta1:l,theta2:h,omega1:f,omega2:b}=t,x=s,m=r,j=i,T=n,w=o,p=Math.cos(l-h),P=Math.sin(l-h),k=Math.sin(l),C=Math.sin(h),E=(x+m)*j-m*j*p*p,g=T/j*E,M=-m*j*f*f*P*p+m*w*C*p+m*T*b*b*P-(x+m)*w*k,y=-m*T*b*b*P*p+(x+m)*w*k*p+(x+m)*j*f*f*P-(x+m)*w*C;let v=M/E,S=y/g;return v-=u*f,S-=u*b,{alpha1:v,alpha2:S}}stateDerivative(t){const{alpha1:s,alpha2:r}=this.accelerations(t);return{theta1:t.omega1,theta2:t.omega2,omega1:s,omega2:r}}addStates(t,s,r){return{theta1:t.theta1+s.theta1*r,theta2:t.theta2+s.theta2*r,omega1:t.omega1+s.omega1*r,omega2:t.omega2+s.omega2*r}}step(t=1){const s=this.dt*t,r=this.stateDerivative(this.state),i=this.stateDerivative(this.addStates(this.state,r,.5*s)),n=this.stateDerivative(this.addStates(this.state,i,.5*s)),o=this.stateDerivative(this.addStates(this.state,n,s));this.state.theta1+=s/6*(r.theta1+2*i.theta1+2*n.theta1+o.theta1),this.state.theta2+=s/6*(r.theta2+2*i.theta2+2*n.theta2+o.theta2),this.state.omega1+=s/6*(r.omega1+2*i.omega1+2*n.omega1+o.omega1),this.state.omega2+=s/6*(r.omega2+2*i.omega2+2*n.omega2+o.omega2),(!isFinite(this.state.theta1)||!isFinite(this.state.theta2)||!isFinite(this.state.omega1)||!isFinite(this.state.omega2)||Math.abs(this.state.omega1)>1e6||Math.abs(this.state.omega2)>1e6)&&(this.state={theta1:Math.PI/2,theta2:Math.PI/2,omega1:0,omega2:0});const u=this.calculatePositions();this.positions.push(u),this.points.push(new A(u.p2.x,u.p2.y,0));const l=1e-7,h={theta1:this.state.theta1+this.pertState.theta1*l,theta2:this.state.theta2+this.pertState.theta2*l,omega1:this.state.omega1+this.pertState.omega1*l,omega2:this.state.omega2+this.pertState.omega2*l},f=this.stateDerivative(this.state),b=this.stateDerivative(h);if(this.pertState.theta1+=(b.theta1-f.theta1)/l*s,this.pertState.theta2+=(b.theta2-f.theta2)/l*s,this.pertState.omega1+=(b.omega1-f.omega1)/l*s,this.pertState.omega2+=(b.omega2-f.omega2)/l*s,this.stepsSinceRenorm++,this.stepsSinceRenorm>=this.RENORM_INTERVAL){const j=Math.sqrt(this.pertState.theta1**2+this.pertState.theta2**2+this.pertState.omega1**2+this.pertState.omega2**2);if(j>0&&isFinite(j)){this.lyapunovSum+=Math.log(j),this.lyapunovSteps++,this.pertState.theta1/=j,this.pertState.theta2/=j,this.pertState.omega1/=j,this.pertState.omega2/=j;const T=this.lyapunovSteps*this.RENORM_INTERVAL*this.dt;this.lyapunovExponent=this.lyapunovSum/T}this.stepsSinceRenorm=0}const x=(this.state.theta2%(2*Math.PI)+2*Math.PI)%(2*Math.PI);return(this.prevTheta2%(2*Math.PI)+2*Math.PI)%(2*Math.PI)>Math.PI&&x<=Math.PI&&x<1&&this.points.length>100&&(this.poincarePoints.push([this.state.theta1,this.state.omega1]),this.poincarePoints.length>this.MAX_POINCARE&&this.poincarePoints.splice(0,this.poincarePoints.length-this.MAX_POINCARE)),this.prevTheta2=this.state.theta2,new A(u.p2.x,u.p2.y,0)}reset(t={theta1:Math.PI/2,theta2:Math.PI/2,omega1:0,omega2:0}){this.state={...t};const s=this.calculatePositions();this.positions=[s],this.points=[new A(s.p2.x,s.p2.y,0)],this.pertState={theta1:1e-6,theta2:0,omega1:0,omega2:0},this.lyapunovSum=0,this.lyapunovSteps=0,this.lyapunovExponent=0,this.stepsSinceRenorm=0,this.prevTheta2=t.theta2,this.poincarePoints=[]}updateParams(t){this.params={...this.params,...t}}trimTrail(t){if(this.points.length>t){const s=this.points.length-t;this.points.splice(0,s),this.positions.splice(0,s)}}getSpeed(){if(this.points.length<2)return 0;const t=this.points[this.points.length-1],s=this.points[this.points.length-2];return t.distanceTo(s)}getCurrentPositions(){return this.positions[this.positions.length-1]}getState(){return{...this.state}}}const Be=({position:a=[0,0,0],scale:t=1,initialCondition:s={theta1:Math.PI/2,theta2:Math.PI/2,omega1:0,omega2:0},isSecondary:r=!1,lastPosRef:i})=>{const n=c.useRef(null),{isPlaying:o,speed:u,trailLength:l,doublePendulumParams:h,_resetCounter:f,colorTheme:b,showLyapunov:x,setLyapunovExponent:m,showPoincare:j,currentSystem:T}=z(),w=F[b],p=c.useMemo(()=>new De(s,h),[s.theta1,s.theta2,s.omega1,s.omega2,h.mass1,h.mass2,h.length1,h.length2,h.gravity,h.damping]);c.useEffect(()=>{p.reset(s)},[f]),c.useEffect(()=>{p.updateParams(h)},[h,p]),c.useEffect(()=>(r||(window.__chaosLabSystem=p,window.__chaosLabSystemType="doublePendulum"),()=>{!r&&window.__chaosLabSystem===p&&(window.__chaosLabSystem=null)}),[p,r]);const P=c.useRef(0);q(()=>{if(!o)return;p.step(u*2),p.trimTrail(l);const L=p.points;if(i&&L.length>0){const N=L[L.length-1];i.current=new A(N.x,N.y,0)}!r&&T==="doublePendulum"&&(x||j)&&(P.current++,P.current%30===0&&m(p.lyapunovExponent))});const k=p.positions.length>0?p.getCurrentPositions():{p1:{x:0,y:0},p2:{x:0,y:0}},C=r?w.trailHue2:w.trailHue1,E=C+.2,g=new X(w.textMuted),M=new X().setHSL(C,.8,.6),y=new X().setHSL(C+.1,.8,.7),v=[k.p1.x*t,k.p1.y*t,0],S=[k.p2.x*t,k.p2.y*t,0];return e.jsxs("group",{ref:n,position:a,children:[e.jsx(he,{points:p.points,hueStart:C,hueEnd:E,lineWidth:1.8,glowIntensity:.4,scale:t,flatZ:!0}),e.jsxs("line",{children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",args:[new Float32Array([0,0,0,...v]),3]})}),e.jsx("lineBasicMaterial",{color:g,linewidth:2,transparent:!0,opacity:.6})]}),e.jsxs("line",{children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",args:[new Float32Array([...v,...S]),3]})}),e.jsx("lineBasicMaterial",{color:g,linewidth:2,transparent:!0,opacity:.6})]}),e.jsxs("mesh",{position:[0,0,0],children:[e.jsx("sphereGeometry",{args:[.03,12,12]}),e.jsx("meshBasicMaterial",{color:"#ffffff",transparent:!0,opacity:.7})]}),e.jsxs("mesh",{position:[v[0],v[1],v[2]],children:[e.jsx("sphereGeometry",{args:[.06*Math.sqrt(h.mass1),16,16]}),e.jsx("meshBasicMaterial",{color:M})]}),e.jsxs("mesh",{position:[S[0],S[1],S[2]],children:[e.jsx("sphereGeometry",{args:[.06*Math.sqrt(h.mass2),16,16]}),e.jsx("meshBasicMaterial",{color:y})]})]})},se=600,ae=80,Oe=.02,$e=()=>{const a=c.useRef(null),{colorTheme:t}=z(),s=F[t],{positions:r,sizes:i}=c.useMemo(()=>{const o=new Float32Array(se*3),u=new Float32Array(se);for(let l=0;l<se;l++)o[l*3]=(Math.random()-.5)*ae,o[l*3+1]=(Math.random()-.5)*ae,o[l*3+2]=(Math.random()-.5)*ae,u[l]=Math.random()*1.5+.3;return{positions:o,sizes:u}},[]),n=c.useMemo(()=>new X(s.starColor),[s.starColor]);return q(({clock:o})=>{if(!a.current)return;const u=o.getElapsedTime()*Oe;a.current.rotation.y=u,a.current.rotation.x=u*.3}),e.jsxs("points",{ref:a,children:[e.jsxs("bufferGeometry",{children:[e.jsx("bufferAttribute",{attach:"attributes-position",args:[r,3]}),e.jsx("bufferAttribute",{attach:"attributes-size",args:[i,1]})]}),e.jsx("pointsMaterial",{color:n,size:.08,transparent:!0,opacity:.4,sizeAttenuation:!0,depthWrite:!1,blending:ee})]})},He={lorenz:.1,rossler:.5,doublePendulum:1},fe=20,qe={lorenz:.8,rossler:4,doublePendulum:2},Ue={lorenz:.4,rossler:2,doublePendulum:.5},We=.025,Ge=.04,Ve=()=>{const{cinematicCamera:a,currentSystem:t,isPlaying:s}=z(),{camera:r}=Me(),i=c.useRef(new A),n=c.useRef(new A),o=c.useRef(!1),u=c.useRef(!1),l=c.useRef(new A),h=c.useRef(new ke),f=c.useRef(0);return q(()=>{if(a&&!u.current&&(l.current.copy(r.position),h.current.copy(r.rotation),f.current=0,u.current=!0),!a&&u.current){u.current=!1,o.current=!1;return}if(!a){o.current=!1;return}const b=window.__chaosLabSystem;if(!b?.points||b.points.length<fe+5)return;const x=b.points,m=He[t]??.1,j=qe[t]??1,T=Ue[t]??.5,w=x.length-1,p=Math.max(0,w-fe),P=x[w],k=x[p],C=new A().subVectors(P,k).normalize();C.lengthSq()<.001&&C.set(0,0,1);const E=t==="doublePendulum";let g,M;if(E){const L=new A(P.x*m,P.y*m,0);g=new A(L.x*.3,L.y*.3+.5,j),M=L}else{const L=new A(P.x*m,P.y*m,P.z*m),N=new A(0,1,0),R=new A().crossVectors(C,N);R.lengthSq()<.001&&R.set(1,0,0),R.normalize();const I=C.clone().multiplyScalar(-j*m).add(N.clone().multiplyScalar(T*m)).add(R.clone().multiplyScalar(.15*m));g=L.clone().add(I);const U=Math.min(w,x.length-1),_=x[U];M=new A(_.x*m,_.y*m,_.z*m)}o.current||(i.current.copy(r.position),n.current.copy(M),o.current=!0),f.current=Math.min(1,f.current+.008);const y=f.current,v=y*y*(3-2*y),S=s?We+(1-v)*.1:.005;i.current.lerp(g,S),n.current.lerp(M,Ge+(1-v)*.1),r.position.copy(i.current),r.lookAt(n.current)}),null},Ke=[{params:{sigma:10,rho:28,beta:2.667},duration:5,transitionTime:4},{params:{sigma:10,rho:15,beta:2.667},duration:3,transitionTime:5},{params:{sigma:10,rho:24.06,beta:2.667},duration:4,transitionTime:4},{params:{sigma:10,rho:28,beta:2.667},duration:3,transitionTime:3},{params:{sigma:14,rho:35,beta:3},duration:4,transitionTime:5},{params:{sigma:10,rho:99.96,beta:2.667},duration:5,transitionTime:6},{params:{sigma:10,rho:45,beta:2.667},duration:3,transitionTime:4},{params:{sigma:10,rho:28,beta:2.667},duration:3,transitionTime:4}],Ye=[{params:{a:.2,b:.2,c:3.5},duration:4,transitionTime:5},{params:{a:.2,b:.2,c:4},duration:3,transitionTime:4},{params:{a:.2,b:.2,c:5},duration:3,transitionTime:4},{params:{a:.2,b:.2,c:5.7},duration:4,transitionTime:3},{params:{a:.2,b:.2,c:8.5},duration:4,transitionTime:5},{params:{a:.3,b:.3,c:12},duration:5,transitionTime:5},{params:{a:.2,b:.2,c:5.7},duration:3,transitionTime:6}],Xe=[{params:{mass1:1,mass2:1,length1:1,length2:1,gravity:9.81,damping:0},duration:5,transitionTime:4},{params:{mass1:1,mass2:3,length1:1,length2:1,gravity:9.81,damping:0},duration:4,transitionTime:5},{params:{mass1:2,mass2:1,length1:1.5,length2:.5,gravity:9.81,damping:0},duration:4,transitionTime:5},{params:{mass1:1,mass2:1,length1:1,length2:1,gravity:15,damping:0},duration:4,transitionTime:4},{params:{mass1:1,mass2:1,length1:1,length2:1,gravity:5,damping:.02},duration:5,transitionTime:5},{params:{mass1:1,mass2:1,length1:1,length2:1,gravity:9.81,damping:0},duration:3,transitionTime:4}],Ze={lorenz:Ke,rossler:Ye,doublePendulum:Xe};function Je(a,t,s){const r={},i=s*s*(3-2*s);for(const n of Object.keys(a)){const o=a[n]??0,u=t[n]??o;r[n]=o+(u-o)*i}return r}const Qe=()=>{const{chaosAutopilot:a,currentSystem:t,setLorenzParams:s,setRosslerParams:r,setDoublePendulumParams:i,setCurrentPreset:n}=z(),o=c.useRef(0),u=c.useRef(0),l=c.useRef("dwell"),h=c.useRef(0);return c.useEffect(()=>{o.current=0,u.current=0,l.current="dwell",h.current=0},[a,t]),q((f,b)=>{if(!a)return;const x=Ze[t];if(!x||x.length===0)return;const m=u.current%x.length,j=(m+1)%x.length,T=x[m],w=x[j];if(h.current+=b,l.current==="dwell")h.current>=T.duration&&(l.current="transition",h.current=0);else{const p=Math.min(1,h.current/T.transitionTime),P=Je(T.params,w.params,p);switch(t){case"lorenz":s(P);break;case"rossler":r(P);break;case"doublePendulum":i(P);break}n(null),p>=1&&(u.current=j,l.current="dwell",h.current=0)}o.current+=b}),null},$=150,et=2,be=50,re=.96,tt={lorenz:.1,rossler:.5,doublePendulum:1},st=()=>{const{isPlaying:a,currentSystem:t,colorTheme:s}=z(),r=F[s],i=c.useRef(null),n=c.useRef(0),o=c.useMemo(()=>({positions:new Float32Array($*3),velocities:new Float32Array($*3),lifetimes:new Float32Array($),colors:new Float32Array($*4),sizes:new Float32Array($)}),[]),u=c.useMemo(()=>new Y(new Float32Array($*3),3),[]),l=c.useMemo(()=>new Y(new Float32Array($*4),4),[]),h=c.useMemo(()=>new Y(new Float32Array($),1),[]),f=c.useMemo(()=>{const b=new X(r.accent);return{r:b.r,g:b.g,b:b.b}},[r.accent]);return c.useEffect(()=>{o.lifetimes.fill(0),n.current=0},[t,o]),q(()=>{if(!a||!i.current)return;const b=window.__chaosLabSystem;if(!b?.points||b.points.length<3)return;const x=b.points,m=tt[t]??.1,j=x[x.length-1],T=x[x.length-3],w=(j.x-T.x)*m,p=(j.y-T.y)*m,P=(j.z-T.z)*m,k=Math.sqrt(w*w+p*p+P*P),C=Math.max(.01,k*2);for(let y=0;y<et;y++){const v=n.current,S=v*3;o.positions[S]=j.x*m,o.positions[S+1]=j.y*m,o.positions[S+2]=t==="doublePendulum"?0:j.z*m,o.velocities[S]=(Math.random()-.5)*C-w*.3,o.velocities[S+1]=(Math.random()-.5)*C-p*.3,o.velocities[S+2]=t==="doublePendulum"?(Math.random()-.5)*.02:(Math.random()-.5)*C-P*.3,o.lifetimes[v]=be,o.sizes[v]=(.5+Math.random()*1)*m*.5,n.current=(n.current+1)%$}const E=u.array,g=l.array,M=h.array;for(let y=0;y<$;y++){const v=y*3,S=y*4;if(o.lifetimes[y]<=0){E[v]=0,E[v+1]=0,E[v+2]=-1e3,g[S+3]=0,M[y]=0;continue}o.lifetimes[y]--,o.positions[v]+=o.velocities[v]*.016,o.positions[v+1]+=o.velocities[v+1]*.016,o.positions[v+2]+=o.velocities[v+2]*.016,o.velocities[v]*=re,o.velocities[v+1]*=re,o.velocities[v+2]*=re;const L=o.lifetimes[y]/be,N=L*L,R=.8+Math.sin(o.lifetimes[y]*.5+y*.7)*.2;E[v]=o.positions[v],E[v+1]=o.positions[v+1],E[v+2]=o.positions[v+2],g[S]=f.r*R,g[S+1]=f.g*R,g[S+2]=f.b*R,g[S+3]=N*R,M[y]=o.sizes[y]*(.3+L*.7)}u.needsUpdate=!0,l.needsUpdate=!0,h.needsUpdate=!0}),e.jsxs("points",{ref:i,children:[e.jsxs("bufferGeometry",{children:[e.jsx("primitive",{object:u,attach:"attributes-position"}),e.jsx("primitive",{object:l,attach:"attributes-color"}),e.jsx("primitive",{object:h,attach:"attributes-size"})]}),e.jsx("pointsMaterial",{vertexColors:!0,size:.04,transparent:!0,opacity:.9,depthWrite:!1,blending:ee,sizeAttenuation:!0})]})},ye={lorenz:{position:[10,10,10],fov:60},rossler:{position:[8,8,8],fov:60},doublePendulum:{position:[0,0,5],fov:50}},at=()=>{const{autoRotate:a,currentSystem:t,cinematicCamera:s}=z();return s?null:e.jsx(Ne,{enablePan:!0,enableZoom:!0,enableRotate:!0,autoRotate:a&&t!=="doublePendulum",autoRotateSpeed:2,maxPolarAngle:Math.PI,minDistance:2,maxDistance:20})},rt=({posA:a,posB:t})=>{const{setDivergence:s,sideBySideMode:r}=z(),i=c.useRef(0);return q(()=>{if(!r||(i.current++,i.current%6!==0))return;const n=a.current,o=t.current;n&&o&&s(n.distanceTo(o))}),null},ne=({position:a=[0,0,0],initialCondition:t,colorHue:s=.6,isSecondary:r=!1,lastPosRef:i})=>{const{currentSystem:n}=z();switch(n){case"lorenz":return e.jsx(Fe,{position:a,initialCondition:t||[1,1,1],colorHue:s,isSecondary:r,lastPosRef:i});case"rossler":return e.jsx(_e,{position:a,initialCondition:t||[1,1,1],colorHue:s,isSecondary:r,lastPosRef:i});case"doublePendulum":return e.jsx(Be,{position:a,initialCondition:t||{theta1:Math.PI/2,theta2:Math.PI/2,omega1:0,omega2:0},colorHue:s,isSecondary:r,lastPosRef:i});default:return null}},nt=()=>{const{sideBySideMode:a,currentSystem:t,initialOffset:s,colorTheme:r}=z(),i=F[r],n=c.useRef(null),o=c.useRef(null);return e.jsxs(e.Fragment,{children:[e.jsx("ambientLight",{intensity:.2}),e.jsx("directionalLight",{position:[10,10,5],intensity:.3}),e.jsx($e,{}),t==="doublePendulum"&&e.jsx(Le,{args:[10,10],position:[0,-3,0],cellColor:"#222233",sectionColor:"#333355",fadeDistance:25,fadeStrength:1}),a?e.jsxs(e.Fragment,{children:[e.jsx(ne,{position:[0,0,0],initialCondition:t==="doublePendulum"?{theta1:Math.PI/2,theta2:Math.PI/2,omega1:0,omega2:0}:[1,1,1],colorHue:i.trailHue1,isSecondary:!1,lastPosRef:n}),e.jsx(ne,{position:[0,0,0],initialCondition:t==="doublePendulum"?{theta1:Math.PI/2+s,theta2:Math.PI/2,omega1:0,omega2:0}:[1+s,1,1],colorHue:i.trailHue2,isSecondary:!0,lastPosRef:o}),e.jsx(rt,{posA:n,posB:o})]}):e.jsx(ne,{}),e.jsx(at,{}),e.jsx(Ve,{}),e.jsx(Qe,{}),e.jsx(st,{})]})};class it extends c.Component{state={hasError:!1,error:null};static getDerivedStateFromError(t){return{hasError:!0,error:t}}handleRetry=()=>{this.setState({hasError:!1,error:null})};render(){return this.state.hasError?e.jsxs("div",{style:{width:"100vw",height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#000010",color:"#ccc",fontFamily:"system-ui, sans-serif",textAlign:"center",padding:"2rem"},children:[e.jsx("h2",{style:{color:"#ff6666",marginBottom:"1rem"},children:"âš ï¸ Rendering Error"}),e.jsx("p",{style:{maxWidth:"400px",lineHeight:1.6,marginBottom:"1rem"},children:"The 3D visualization encountered an error. This can happen if WebGL is not available or if GPU resources were exhausted."}),e.jsx("code",{style:{background:"rgba(255,255,255,0.05)",padding:"8px 16px",borderRadius:"6px",fontSize:"12px",color:"#ff9999",marginBottom:"1.5rem",maxWidth:"80vw",overflow:"auto"},children:this.state.error?.message||"Unknown error"}),e.jsx("button",{onClick:this.handleRetry,style:{padding:"12px 24px",background:"#88ccff",color:"#000",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:600,cursor:"pointer"},children:"ðŸ”„ Retry"})]}):this.props.children}}const ot=()=>{const{currentSystem:a,colorTheme:t}=z(),s=F[t],r=ye[a]??ye.lorenz;return e.jsx(it,{children:e.jsx("div",{style:{width:"100vw",height:"100vh",background:s.bg},role:"img","aria-label":`3D visualization of ${a==="lorenz"?"Lorenz attractor":a==="rossler"?"RÃ¶ssler attractor":"double pendulum"} chaos system`,children:e.jsxs(Ee,{camera:{position:r.position,fov:r.fov},gl:{antialias:!0,alpha:!0,powerPreference:"high-performance",preserveDrawingBuffer:!0},children:[e.jsx("color",{attach:"background",args:[s.bg]}),e.jsx("fog",{attach:"fog",args:[s.bg,30,60]}),e.jsx(c.Suspense,{fallback:null,children:e.jsx(nt,{})})]})})})},lt={classic:"ðŸŒŒ Classic",neon:"ðŸ’œ Neon",blueprint:"ðŸ“ Blueprint",terminal:"ðŸ’» Terminal"},ct={lorenz:"ðŸ¦‹ Lorenz",rossler:"ðŸŒ€ RÃ¶ssler",doublePendulum:"âš¡ Pendulum"},ht=()=>{const[a,t]=c.useState(!1),[s,r]=c.useState(!1);c.useEffect(()=>{const d=()=>r(window.innerWidth<=768);return d(),window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]);const{currentSystem:i,setCurrentSystem:n,isPlaying:o,setIsPlaying:u,speed:l,setSpeed:h,trailLength:f,setTrailLength:b,sideBySideMode:x,setSideBySideMode:m,initialOffset:j,setInitialOffset:T,autoRotate:w,setAutoRotate:p,currentPreset:P,setCurrentPreset:k,colorTheme:C,setColorTheme:E,lorenzParams:g,setLorenzParams:M,rosslerParams:y,setRosslerParams:v,doublePendulumParams:S,setDoublePendulumParams:L,resetSimulation:N,showLyapunov:R,setShowLyapunov:I,showBifurcation:U,setShowBifurcation:_,showPoincare:B,setShowPoincare:te,showParameterSpace:O,setShowParameterSpace:W,cinematicCamera:D,setCinematicCamera:Z,chaosAutopilot:J,setChaosAutopilot:Se,setStoryMode:je}=z(),G=F[C],we=d=>{const Q=ge[i].find(Te=>Te.name===d);if(Q){switch(i){case"lorenz":M(Q.params);break;case"rossler":v(Q.params);break;case"doublePendulum":L(Q.params);break}k(d)}},Pe=d=>{n(d),k(null)},ue=d=>d>=.01?d.toFixed(3):d.toExponential(1),Re=()=>{switch(i){case"lorenz":return e.jsxs("div",{className:"parameter-group",role:"group","aria-label":"Lorenz system parameters",children:[e.jsx("h4",{children:"Lorenz Parameters"}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"sigma-slider",children:["Ïƒ (sigma): ",g.sigma.toFixed(2)]}),e.jsx("input",{id:"sigma-slider",type:"range",min:"0.1",max:"30",step:"0.1",value:g.sigma,"aria-valuemin":.1,"aria-valuemax":30,"aria-valuenow":g.sigma,"aria-label":`Sigma: ${g.sigma.toFixed(2)}`,onChange:d=>M({sigma:parseFloat(d.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"rho-slider",children:["Ï (rho): ",g.rho.toFixed(2)]}),e.jsx("input",{id:"rho-slider",type:"range",min:"0.1",max:"50",step:"0.1",value:g.rho,"aria-valuemin":.1,"aria-valuemax":50,"aria-valuenow":g.rho,"aria-label":`Rho: ${g.rho.toFixed(2)}`,onChange:d=>M({rho:parseFloat(d.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"beta-slider",children:["Î² (beta): ",g.beta.toFixed(3)]}),e.jsx("input",{id:"beta-slider",type:"range",min:"0.1",max:"10",step:"0.01",value:g.beta,"aria-valuemin":.1,"aria-valuemax":10,"aria-valuenow":g.beta,"aria-label":`Beta: ${g.beta.toFixed(3)}`,onChange:d=>M({beta:parseFloat(d.target.value)})})]})]});case"rossler":return e.jsxs("div",{className:"parameter-group",role:"group","aria-label":"RÃ¶ssler system parameters",children:[e.jsx("h4",{children:"RÃ¶ssler Parameters"}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"a-slider",children:["a: ",y.a.toFixed(3)]}),e.jsx("input",{id:"a-slider",type:"range",min:"0.01",max:"1.0",step:"0.01",value:y.a,"aria-label":`Parameter a: ${y.a.toFixed(3)}`,onChange:d=>v({a:parseFloat(d.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"b-slider",children:["b: ",y.b.toFixed(3)]}),e.jsx("input",{id:"b-slider",type:"range",min:"0.01",max:"1.0",step:"0.01",value:y.b,"aria-label":`Parameter b: ${y.b.toFixed(3)}`,onChange:d=>v({b:parseFloat(d.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"c-slider",children:["c: ",y.c.toFixed(2)]}),e.jsx("input",{id:"c-slider",type:"range",min:"1.0",max:"20.0",step:"0.1",value:y.c,"aria-label":`Parameter c: ${y.c.toFixed(2)}`,onChange:d=>v({c:parseFloat(d.target.value)})})]})]});case"doublePendulum":return e.jsxs("div",{className:"parameter-group",role:"group","aria-label":"Double pendulum parameters",children:[e.jsx("h4",{children:"Pendulum Parameters"}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"mass1-slider",children:["Mass 1: ",S.mass1.toFixed(2)]}),e.jsx("input",{id:"mass1-slider",type:"range",min:"0.1",max:"5.0",step:"0.1",value:S.mass1,"aria-label":`Mass 1: ${S.mass1.toFixed(2)}`,onChange:d=>L({mass1:parseFloat(d.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"mass2-slider",children:["Mass 2: ",S.mass2.toFixed(2)]}),e.jsx("input",{id:"mass2-slider",type:"range",min:"0.1",max:"5.0",step:"0.1",value:S.mass2,"aria-label":`Mass 2: ${S.mass2.toFixed(2)}`,onChange:d=>L({mass2:parseFloat(d.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"len1-slider",children:["Length 1: ",S.length1.toFixed(2)]}),e.jsx("input",{id:"len1-slider",type:"range",min:"0.2",max:"2.0",step:"0.1",value:S.length1,"aria-label":`Length 1: ${S.length1.toFixed(2)}`,onChange:d=>L({length1:parseFloat(d.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"len2-slider",children:["Length 2: ",S.length2.toFixed(2)]}),e.jsx("input",{id:"len2-slider",type:"range",min:"0.2",max:"2.0",step:"0.1",value:S.length2,"aria-label":`Length 2: ${S.length2.toFixed(2)}`,onChange:d=>L({length2:parseFloat(d.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"gravity-slider",children:["Gravity: ",S.gravity.toFixed(2)]}),e.jsx("input",{id:"gravity-slider",type:"range",min:"1.0",max:"20.0",step:"0.1",value:S.gravity,"aria-label":`Gravity: ${S.gravity.toFixed(2)}`,onChange:d=>L({gravity:parseFloat(d.target.value)})})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"damping-slider",children:["Damping: ",S.damping.toFixed(3)]}),e.jsx("input",{id:"damping-slider",type:"range",min:"0.0",max:"0.2",step:"0.005",value:S.damping,"aria-label":`Damping: ${S.damping.toFixed(3)}`,onChange:d=>L({damping:parseFloat(d.target.value)})})]})]});default:return null}};return e.jsxs("aside",{className:`controls ${a?"collapsed":""} ${s?"mobile":""}`,role:"region","aria-label":"Simulation controls",style:{"--panel-bg":G.panelBg,"--panel-border":G.panelBorder,"--text-color":G.text,"--text-muted":G.textMuted,"--accent":G.accent,"--accent2":G.accent2,"--heading":G.heading,"--param-color":G.paramColor},children:[e.jsx("button",{className:"controls-toggle",onClick:()=>t(!a),"aria-label":a?"Show controls":"Hide controls","aria-expanded":!a,children:a?"âš™ï¸":"âœ•"}),!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{id:"system-heading",children:"Chaos System"}),e.jsx("div",{className:"system-tabs",role:"tablist","aria-labelledby":"system-heading",children:["lorenz","rossler","doublePendulum"].map(d=>e.jsx("button",{role:"tab","aria-selected":i===d,"aria-label":`Select ${d==="doublePendulum"?"Double Pendulum":d} system`,className:`system-tab ${i===d?"active":""}`,onClick:()=>Pe(d),children:ct[d]},d))})]}),e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{children:"Simulation"}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{onClick:()=>u(!o),className:`play-button ${o?"playing":"paused"}`,"aria-label":o?"Pause simulation":"Play simulation",children:o?"â¸ Pause":"â–¶ Play"}),e.jsx("button",{onClick:N,className:"reset-button","aria-label":"Reset simulation",children:"ðŸ”„ Reset"})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"speed-slider",children:["Speed: ",l.toFixed(1),"x"]}),e.jsx("input",{id:"speed-slider",type:"range",min:"0.1",max:"5.0",step:"0.1",value:l,"aria-label":`Simulation speed: ${l.toFixed(1)}x`,onChange:d=>h(parseFloat(d.target.value))})]}),e.jsxs("div",{className:"slider-group",children:[e.jsxs("label",{htmlFor:"trail-slider",children:["Trail: ",f,f>3e3&&e.jsx("span",{className:"warn",children:" âš ï¸ High"})]}),e.jsx("input",{id:"trail-slider",type:"range",min:"100",max:"5000",step:"100",value:f,"aria-label":`Trail length: ${f} points`,onChange:d=>b(parseInt(d.target.value))})]})]}),e.jsxs("div",{className:"control-section butterfly-section",children:[e.jsx("h3",{children:"ðŸ¦‹ Butterfly Effect"}),e.jsx("div",{className:"checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:x,"aria-label":"Enable butterfly mode: show two systems with tiny initial difference",onChange:d=>{m(d.target.checked),d.target.checked&&N()}}),"Enable Butterfly Mode"]})}),x&&e.jsxs("div",{className:"slider-group offset-slider",children:[e.jsxs("label",{htmlFor:"offset-slider",children:["Initial Offset: ",e.jsx("span",{className:"offset-value",children:ue(j)})]}),e.jsx("input",{id:"offset-slider",type:"range",min:"-6",max:"-0.5",step:"0.1",value:Math.log10(j),"aria-label":`Initial offset between systems: ${ue(j)}`,onChange:d=>{T(Math.pow(10,parseFloat(d.target.value))),N()}}),e.jsxs("div",{className:"offset-labels","aria-hidden":"true",children:[e.jsx("span",{children:"Tiny"}),e.jsx("span",{children:"Large"})]})]})]}),e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{children:"View"}),i!=="doublePendulum"&&e.jsx("div",{className:"checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:w,"aria-label":"Auto-rotate camera around the attractor",onChange:d=>p(d.target.checked)}),"Auto Rotate"]})})]}),e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{children:"âœ¨ Experience"}),e.jsxs("div",{className:"experience-buttons",children:[e.jsx("button",{className:`experience-btn cinematic ${D?"active":""}`,onClick:()=>Z(!D),"aria-pressed":D,"aria-label":"Toggle cinematic chase camera that follows the trail",children:"ðŸŽ¬ Chase Cam"}),e.jsx("button",{className:`experience-btn autopilot ${J?"active":""}`,onClick:()=>Se(!J),"aria-pressed":J,"aria-label":"Toggle chaos autopilot that morphs parameters automatically",children:"ðŸ¤– Autopilot"}),e.jsx("button",{className:"experience-btn story",onClick:()=>{je(!0),p(!0)},"aria-label":"Launch guided story mode tour",children:"ðŸ“– Story Mode"})]}),J&&e.jsx("div",{className:"autopilot-hint",children:"Parameters are morphing through interesting regions..."}),D&&e.jsx("div",{className:"autopilot-hint",children:"Camera is following the trail head. Orbit controls disabled."})]}),e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{id:"theme-heading",children:"Theme"}),e.jsx("div",{className:"theme-grid",role:"radiogroup","aria-labelledby":"theme-heading",children:Object.keys(F).map(d=>e.jsx("button",{role:"radio","aria-checked":C===d,"aria-label":`${d} theme`,className:`theme-btn ${C===d?"active":""}`,onClick:()=>E(d),style:{"--tbg":F[d].bg,"--taccent":F[d].accent},children:lt[d]},d))})]}),e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{children:"Presets"}),e.jsx("div",{className:"preset-chips",role:"group","aria-label":"Parameter presets",children:ge[i].map(d=>e.jsx("button",{className:`preset-chip ${P===d.name?"active":""}`,onClick:()=>we(d.name),"aria-label":`${d.name}: ${d.description}`,"aria-pressed":P===d.name,children:d.name},d.name))})]}),Re(),i!=="doublePendulum"&&e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{children:"ðŸ”¬ Analysis"}),e.jsxs("div",{className:"analysis-buttons",children:[e.jsx("button",{className:`analysis-btn ${R?"active":""}`,onClick:()=>I(!R),"aria-pressed":R,"aria-label":"Toggle Lyapunov exponent indicator",children:"Î» Lyapunov"}),e.jsx("button",{className:`analysis-btn ${U?"active":""}`,onClick:()=>_(!U),"aria-pressed":U,"aria-label":"Toggle bifurcation diagram",children:"ðŸ“ˆ Bifurcation"}),e.jsx("button",{className:`analysis-btn ${B?"active":""}`,onClick:()=>te(!B),"aria-pressed":B,"aria-label":"Toggle PoincarÃ© section",children:"â—Ž PoincarÃ©"}),e.jsx("button",{className:`analysis-btn ${O?"active":""}`,onClick:()=>W(!O),"aria-pressed":O,"aria-label":"Toggle parameter space explorer",children:"ðŸ—ºï¸ Param Space"})]})]})]})]})},ut={lorenz:{title:"Lorenz Attractor",description:"The Lorenz attractor is a set of chaotic solutions of the Lorenz system, discovered by Edward Lorenz in 1963. It arises from a simplified model of atmospheric convection.",equations:["dx/dt = Ïƒ(y - x)","dy/dt = x(Ï - z) - y","dz/dt = xy - Î²z"],whatMakesChaotic:'The system is chaotic because small changes in initial conditions lead to drastically different outcomes over time. This is the famous "butterfly effect" â€” a butterfly flapping its wings in Brazil could theoretically cause a tornado in Texas.',parameters:{"Ïƒ (sigma)":"Prandtl number â€” relates viscosity to thermal conductivity","Ï (rho)":"Rayleigh number â€” measures temperature difference","Î² (beta)":"Geometric factor related to the size of convection cells"}},rossler:{title:"RÃ¶ssler Attractor",description:"The RÃ¶ssler attractor is another chaotic system, developed by Otto RÃ¶ssler in 1976. It was designed to be simpler than the Lorenz system while still exhibiting chaotic behavior.",equations:["dx/dt = -y - z","dy/dt = x + ay","dz/dt = b + z(x - c)"],whatMakesChaotic:"The RÃ¶ssler system shows how even simple nonlinear equations can produce chaos. The attractor has a characteristic spiral structure that folds back on itself, creating sensitive dependence on initial conditions.",parameters:{a:"Controls the rate of expansion in the y direction",b:"Constant term that affects the z component",c:"Controls the folding and stretching of the attractor"}},doublePendulum:{title:"Double Pendulum",description:"A double pendulum consists of two pendulums attached end to end. Despite being a deterministic system governed by well-known physical laws, it exhibits chaotic motion.",equations:["Complex coupled differential equations","involving angles Î¸â‚, Î¸â‚‚ and their","angular velocities Ï‰â‚, Ï‰â‚‚"],whatMakesChaotic:"The chaos arises from the nonlinear coupling between the two pendulums. Small changes in the initial angles or velocities can lead to completely different trajectories. This demonstrates that chaos can emerge from simple, everyday systems.",parameters:{"Mass 1, Mass 2":"Masses of the first and second pendulum bobs","Length 1, Length 2":"Lengths of the first and second pendulum arms",Gravity:"Gravitational acceleration",Damping:"Energy loss due to friction (0 = no damping)"}}},dt=()=>{const{currentSystem:a,showInfoPanel:t,setShowInfoPanel:s}=z();if(!t)return e.jsx("button",{className:"info-toggle collapsed",onClick:()=>s(!0),"aria-label":"Show system information panel",children:"â„¹ï¸"});const r=ut[a];return e.jsxs("aside",{className:"info-panel",role:"complementary","aria-label":"System information",children:[e.jsxs("div",{className:"info-header",children:[e.jsx("h2",{children:r.title}),e.jsx("button",{className:"info-close",onClick:()=>s(!1),"aria-label":"Close information panel",children:"âœ•"})]}),e.jsxs("div",{className:"info-content",children:[e.jsxs("section",{"aria-labelledby":"info-overview",children:[e.jsx("h3",{id:"info-overview",children:"Overview"}),e.jsx("p",{children:r.description})]}),e.jsxs("section",{"aria-labelledby":"info-equations",children:[e.jsx("h3",{id:"info-equations",children:"Equations"}),e.jsx("div",{className:"equations",role:"math","aria-label":"System equations",children:r.equations.map((i,n)=>e.jsx("div",{className:"equation",children:i},n))})]}),e.jsxs("section",{"aria-labelledby":"info-chaos",children:[e.jsx("h3",{id:"info-chaos",children:"What Makes It Chaotic?"}),e.jsx("p",{children:r.whatMakesChaotic})]}),e.jsxs("section",{"aria-labelledby":"info-params",children:[e.jsx("h3",{id:"info-params",children:"Parameters"}),e.jsx("dl",{className:"parameters",children:Object.entries(r.parameters).map(([i,n])=>e.jsxs("div",{className:"parameter",children:[e.jsx("dt",{children:e.jsx("strong",{children:i})}),e.jsx("dd",{children:n})]},i))})]}),e.jsxs("section",{"aria-labelledby":"info-tips",children:[e.jsx("h3",{id:"info-tips",children:"Tips"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Try the side-by-side mode to see how small changes create big differences"}),e.jsx("li",{children:"Experiment with different presets to explore various behaviors"}),e.jsx("li",{children:"Adjust the trail length to see more or less of the trajectory"}),e.jsx("li",{children:"Use the speed control to slow down and observe the motion closely"})]})]})]})]})},K=[{title:"Welcome to Chaos Lab! ðŸ¦‹",description:"Explore the beautiful world of chaos theory through interactive visualizations. Watch as simple equations create complex, unpredictable patterns."},{title:"Try Side-by-Side Mode",description:"Enable 'Butterfly Mode' to see the butterfly effect in action. Two systems with tiny differences will evolve completely differently!",highlight:"side-by-side"},{title:"Experiment with Parameters",description:"Adjust the sliders to see how small changes in parameters can dramatically alter the behavior. Try the preset configurations for interesting starting points.",highlight:"parameters"},{title:"Explore Different Systems",description:"Switch between Lorenz Attractor, RÃ¶ssler Attractor, and Double Pendulum to see different types of chaotic behavior.",highlight:"systems"},{title:"Learn More",description:"Click the info button (â„¹ï¸) to learn about the mathematics and physics behind each system. Ready to explore chaos?",highlight:"info"}],mt=()=>{const[a,t]=c.useState(!1),[s,r]=c.useState(0),{setSideBySideMode:i,setShowInfoPanel:n}=z(),o=c.useRef(null);c.useEffect(()=>{localStorage.getItem("chaosLabTutorial")||t(!0)},[]),c.useEffect(()=>{a&&o.current&&o.current.focus()},[a,s]);const u=c.useCallback(()=>{localStorage.setItem("chaosLabTutorial","completed"),t(!1)},[]),l=c.useCallback(()=>{s<K.length-1?r(s+1):u()},[s,u]),h=c.useCallback(()=>{switch(K[s].highlight){case"side-by-side":i(!0);break;case"info":n(!0);break}l()},[s,l,i,n]),f=c.useCallback(m=>{m.key==="Escape"?u():(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),l())},[u,l]);if(!a)return null;const b=K[s],x=s===K.length-1;return e.jsx("div",{className:"quick-start-overlay",role:"dialog","aria-modal":"true","aria-label":"Quick start tutorial",onKeyDown:f,children:e.jsxs("div",{className:"quick-start-modal",ref:o,tabIndex:-1,children:[e.jsxs("div",{className:"quick-start-header",children:[e.jsx("h2",{id:"qs-title",children:b.title}),e.jsx("button",{className:"quick-start-close",onClick:u,"aria-label":"Close tutorial",children:"âœ•"})]}),e.jsxs("div",{className:"quick-start-content",children:[e.jsx("p",{id:"qs-desc",children:b.description}),e.jsx("div",{className:"quick-start-progress",role:"progressbar","aria-valuenow":s+1,"aria-valuemin":1,"aria-valuemax":K.length,"aria-label":`Step ${s+1} of ${K.length}`,children:K.map((m,j)=>e.jsx("div",{className:`progress-dot ${j<=s?"active":""}`,"aria-hidden":"true"},j))})]}),e.jsxs("div",{className:"quick-start-actions",children:[e.jsx("button",{className:"quick-start-skip",onClick:u,children:"Skip Tutorial"}),e.jsx("button",{className:"quick-start-next",onClick:b.highlight?h:l,"aria-describedby":"qs-desc",children:x?"Let's Explore!":"Next"})]})]})})},pt=()=>{const{sideBySideMode:a,divergence:t,colorTheme:s}=z(),r=F[s];if(!a)return null;const i=Math.log10(Math.max(t,1e-4)),n=Math.min(1,Math.max(0,(i+4)/6)),o=Math.round(n*100),u=(1-n)*120,l=t<.001?t.toExponential(2):t.toFixed(3);return e.jsxs("div",{role:"meter","aria-label":"Divergence between the two systems","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":1,"aria-valuetext":`Divergence: ${l}`,style:{position:"absolute",bottom:80,left:"50%",transform:"translateX(-50%)",zIndex:200,pointerEvents:"none",textAlign:"center",fontFamily:"'Segoe UI', sans-serif"},children:[e.jsx("div",{style:{color:r.textMuted,fontSize:"11px",letterSpacing:"2px",textTransform:"uppercase",marginBottom:6},children:"Divergence"}),e.jsx("div",{style:{width:200,height:6,background:`rgba(${r.bgRgb}, 0.7)`,borderRadius:3,overflow:"hidden",border:`1px solid ${r.panelBorder}`,backdropFilter:"blur(4px)"},children:e.jsx("div",{style:{width:`${o}%`,height:"100%",background:`hsl(${u}, 90%, 55%)`,borderRadius:3,transition:"width 0.1s ease, background 0.3s ease",boxShadow:`0 0 8px hsla(${u}, 90%, 55%, 0.6)`}})}),e.jsx("div",{style:{color:r.text,fontSize:"13px",marginTop:4,fontVariantNumeric:"tabular-nums",fontWeight:600,textShadow:`0 0 10px hsla(${u}, 90%, 55%, 0.5)`},children:l})]})},gt=()=>{const{showLyapunov:a,lyapunovExponent:t,colorTheme:s}=z(),r=F[s],i=c.useRef("");if(!a)return null;const o=(Math.max(-2,Math.min(3,t))+2)/5,u=(1-o)*120,l=Math.min(100,Math.max(5,o*100)),h=t>.1?"Chaotic":t>-.05?"Edge of Chaos":"Stable",f=t>.1?"ðŸ”´":t>-.05?"ðŸŸ¡":"ðŸŸ¢",b=i.current!==h;return b&&(i.current=h),e.jsxs("div",{className:"lyapunov-indicator",role:"region","aria-label":`Lyapunov exponent indicator: system is ${h}`,style:{"--panel-bg":r.panelBg,"--panel-border":r.panelBorder,"--text":r.text,"--text-muted":r.textMuted,"--bar-hue":u},children:[e.jsxs("div",{className:"lyapunov-header",children:[e.jsx("span",{className:"lyapunov-label",children:"Î» (Lyapunov)"}),e.jsxs("span",{className:"lyapunov-status","aria-hidden":"true",children:[f," ",h]})]}),e.jsxs("div",{className:"lyapunov-value",style:{color:`hsl(${u}, 90%, 60%)`},children:["Î» = ",t.toFixed(3)]}),e.jsxs("div",{className:"lyapunov-bar-track",role:"meter","aria-valuenow":t,"aria-valuemin":-2,"aria-valuemax":3,"aria-label":"Lyapunov exponent",children:[e.jsx("div",{className:"lyapunov-bar-fill",style:{width:`${l}%`,background:`hsl(${u}, 85%, 50%)`,boxShadow:`0 0 10px hsla(${u}, 85%, 50%, 0.6)`}}),e.jsx("div",{className:"lyapunov-bar-zero","aria-hidden":"true"})]}),e.jsx("div",{className:"lyapunov-hint",children:"Measures how fast nearby paths diverge. Positive = chaos."}),b&&e.jsxs("div",{className:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true",children:["System is now ",h,", Lyapunov exponent: ",t.toFixed(2)]})]})},ft=[{key:"Space",action:"Play / Pause simulation"},{key:"R",action:"Reset simulation"},{key:"1",action:"Switch to Lorenz attractor"},{key:"2",action:"Switch to RÃ¶ssler attractor"},{key:"3",action:"Switch to Double Pendulum"},{key:"S",action:"Toggle side-by-side (Butterfly) mode"},{key:"C",action:"Toggle cinematic chase camera"},{key:"A",action:"Toggle chaos autopilot"},{key:"T",action:"Cycle through color themes"},{key:"P",action:"Screenshot current view"},{key:"L",action:"Copy share link to clipboard"},{key:"H / ?",action:"Toggle this help overlay"},{key:"Esc",action:"Close open dialogs"}],bt=({isVisible:a,onClose:t})=>{const s=c.useRef(null);return c.useEffect(()=>{a&&s.current?.focus()},[a]),c.useEffect(()=>{if(!a)return;const r=i=>{(i.key==="Escape"||i.key==="h"||i.key==="H"||i.key==="?")&&(i.preventDefault(),t())};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[a,t]),a?e.jsx("div",{className:"help-overlay",role:"dialog","aria-modal":"true","aria-label":"Keyboard shortcuts",onClick:t,children:e.jsxs("div",{className:"help-modal",ref:s,tabIndex:-1,onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"help-header",children:[e.jsx("h2",{children:"âŒ¨ï¸ Keyboard Shortcuts"}),e.jsx("button",{className:"help-close",onClick:t,"aria-label":"Close help",children:"âœ•"})]}),e.jsx("div",{className:"help-grid",children:ft.map(({key:r,action:i})=>e.jsxs("div",{className:"help-row",children:[e.jsx("kbd",{className:"help-key",children:r}),e.jsx("span",{className:"help-action",children:i})]},r))}),e.jsxs("div",{className:"help-footer",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Mouse:"})," Drag to rotate Â· Scroll to zoom Â· Right-drag to pan"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Touch:"})," Drag to rotate Â· Pinch to zoom"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Right-click"})," canvas for quick actions"]})]})]})}):null},yt=12e3,ie=2e3,xt=()=>{const{storyMode:a,setStoryMode:t,currentStoryIndex:s,setCurrentStoryIndex:r,setCurrentSystem:i,setLorenzParams:n,setRosslerParams:o,setDoublePendulumParams:u,setTrailLength:l,setSpeed:h,setSideBySideMode:f,setInitialOffset:b,setCurrentPreset:x,setAutoRotate:m,resetSimulation:j,colorTheme:T,setCinematicCamera:w}=z(),p=F[T],P=c.useRef(null),[k,C]=c.useState(!1),[E,g]=c.useState(0),M=c.useCallback(N=>{const R=V[N];if(R){switch(i(R.system),l(R.trailLength),h(R.speed),f(R.sideBySide),b(R.offset),x(null),m(!0),R.system){case"lorenz":n(R.params);break;case"rossler":o(R.params);break;case"doublePendulum":u(R.params);break}j()}},[i,n,o,u,l,h,f,b,x,m,j]),y=c.useCallback(()=>{C(!0),setTimeout(()=>{const N=(s+1)%V.length;r(N),M(N),g(N),setTimeout(()=>C(!1),100)},ie/2)},[s,r,M]),v=c.useCallback(()=>{C(!0),setTimeout(()=>{const N=(s-1+V.length)%V.length;r(N),M(N),g(N),setTimeout(()=>C(!1),100)},ie/2)},[s,r,M]);c.useEffect(()=>{a&&(M(s),g(s))},[a]),c.useEffect(()=>{if(a)return P.current=setTimeout(y,yt),()=>{P.current&&clearTimeout(P.current)}},[a,s,y]);const S=c.useCallback(()=>{t(!1),w(!1),m(!1),P.current&&clearTimeout(P.current)},[t,w,m]);if(c.useEffect(()=>{if(!a)return;const N=R=>{R.key==="Escape"?S():R.key==="ArrowRight"||R.key===" "?(R.preventDefault(),y()):R.key==="ArrowLeft"&&(R.preventDefault(),v())};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},[a,y,v,S]),!a)return null;const L=V[E];return L?e.jsxs("div",{className:`story-mode-overlay ${k?"transitioning":""}`,style:{"--story-accent":p.accent,"--story-bg":p.panelBg,"--story-text":p.text,"--story-border":p.panelBorder},children:[e.jsx("div",{className:"story-progress",children:V.map((N,R)=>e.jsx("button",{className:`story-dot ${R===E?"active":""} ${R<E?"visited":""}`,onClick:()=>{C(!0),setTimeout(()=>{r(R),M(R),g(R),setTimeout(()=>C(!1),100)},ie/2)},"aria-label":`Go to story ${R+1}: ${V[R].name}`},R))}),e.jsxs("div",{className:"story-card",children:[e.jsx("div",{className:"story-emoji",children:L.emoji}),e.jsxs("div",{className:"story-text",children:[e.jsx("h2",{className:"story-title",children:L.name}),e.jsx("p",{className:"story-description",children:L.description})]}),e.jsxs("div",{className:"story-counter",children:[E+1," / ",V.length]})]}),e.jsxs("div",{className:"story-nav",children:[e.jsx("button",{className:"story-nav-btn",onClick:v,"aria-label":"Previous story",children:"â†"}),e.jsx("button",{className:"story-nav-btn story-exit",onClick:S,"aria-label":"Exit story mode",children:"âœ• Exit"}),e.jsx("button",{className:"story-nav-btn",onClick:y,"aria-label":"Next story",children:"â†’"})]})]}):null};function vt(){const{currentSystem:a}=z();return c.useCallback(()=>{const s=document.querySelector("canvas");if(s)try{const r=a==="doublePendulum"?"pendulum":a,i=new Date().toISOString().split("T")[0],n=`chaos-lab-${r}-${i}.png`;s.toBlob(o=>{if(!o)return;const u=URL.createObjectURL(o),l=document.createElement("a");l.href=u,l.download=n,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(u)},"image/png")}catch(r){console.warn("Screenshot failed:",r)}},[a])}const St=new Set(["lorenz","rossler","doublePendulum"]),jt=new Set(["classic","neon","blueprint","terminal"]);function ve(){const a=z.getState(),t=new URLSearchParams;switch(t.set("sys",a.currentSystem),t.set("theme",a.colorTheme),t.set("speed",a.speed.toFixed(1)),t.set("trail",String(a.trailLength)),t.set("sbs",a.sideBySideMode?"1":"0"),a.sideBySideMode&&t.set("offset",a.initialOffset.toExponential(1)),a.currentSystem){case"lorenz":t.set("sigma",a.lorenzParams.sigma.toFixed(2)),t.set("rho",a.lorenzParams.rho.toFixed(2)),t.set("beta",a.lorenzParams.beta.toFixed(3));break;case"rossler":t.set("a",a.rosslerParams.a.toFixed(3)),t.set("b",a.rosslerParams.b.toFixed(3)),t.set("c",a.rosslerParams.c.toFixed(2));break;case"doublePendulum":t.set("m1",a.doublePendulumParams.mass1.toFixed(2)),t.set("m2",a.doublePendulumParams.mass2.toFixed(2)),t.set("l1",a.doublePendulumParams.length1.toFixed(2)),t.set("l2",a.doublePendulumParams.length2.toFixed(2)),t.set("g",a.doublePendulumParams.gravity.toFixed(2)),t.set("damp",a.doublePendulumParams.damping.toFixed(3));break}return"#"+t.toString()}function wt(a){if(!a||a.length<2)return!1;try{const t=new URLSearchParams(a.slice(1)),s=z.getState(),r=t.get("sys");if(r&&St.has(r))s.setCurrentSystem(r);else return!1;const i=t.get("theme");i&&jt.has(i)&&s.setColorTheme(i);const n=parseFloat(t.get("speed")||"");n>0&&n<=5&&s.setSpeed(n);const o=parseInt(t.get("trail")||"");if(o>=100&&o<=5e3&&s.setTrailLength(o),t.get("sbs")==="1"){s.setSideBySideMode(!0);const l=parseFloat(t.get("offset")||"");l>0&&l<1&&s.setInitialOffset(l)}switch(r){case"lorenz":{const l=parseFloat(t.get("sigma")||""),h=parseFloat(t.get("rho")||""),f=parseFloat(t.get("beta")||"");l>0&&s.setLorenzParams({sigma:l}),h>0&&s.setLorenzParams({rho:h}),f>0&&s.setLorenzParams({beta:f});break}case"rossler":{const l=parseFloat(t.get("a")||""),h=parseFloat(t.get("b")||""),f=parseFloat(t.get("c")||"");l>0&&s.setRosslerParams({a:l}),h>0&&s.setRosslerParams({b:h}),f>0&&s.setRosslerParams({c:f});break}case"doublePendulum":{const l=parseFloat(t.get("m1")||""),h=parseFloat(t.get("m2")||""),f=parseFloat(t.get("l1")||""),b=parseFloat(t.get("l2")||""),x=parseFloat(t.get("g")||""),m=parseFloat(t.get("damp")||"");l>0&&s.setDoublePendulumParams({mass1:l}),h>0&&s.setDoublePendulumParams({mass2:h}),f>0&&s.setDoublePendulumParams({length1:f}),b>0&&s.setDoublePendulumParams({length2:b}),x>0&&s.setDoublePendulumParams({gravity:x}),m>=0&&s.setDoublePendulumParams({damping:m});break}}return!0}catch{return!1}}function xe(){return window.location.origin+window.location.pathname+ve()}function Pt(){const a=c.useRef(!1);c.useEffect(()=>{a.current||(a.current=!0,window.location.hash&&wt(window.location.hash))},[]);const{currentSystem:t,colorTheme:s,speed:r,trailLength:i,sideBySideMode:n,initialOffset:o,lorenzParams:u,rosslerParams:l,doublePendulumParams:h}=z();c.useEffect(()=>{const f=setTimeout(()=>{window.history.replaceState(null,"",ve())},500);return()=>clearTimeout(f)},[t,s,r,i,n,o,u,l,h])}const oe=["classic","neon","blueprint","terminal"],le=["lorenz","rossler","doublePendulum"];function Rt(a){const t=vt();c.useEffect(()=>{const s=r=>{const i=r.target.tagName;if(i==="INPUT"||i==="TEXTAREA"||i==="SELECT"||r.ctrlKey||r.metaKey||r.altKey)return;const n=z.getState();switch(r.key){case" ":r.preventDefault(),n.setIsPlaying(!n.isPlaying);break;case"r":case"R":n.resetSimulation();break;case"1":n.setCurrentSystem(le[0]),n.setCurrentPreset(null);break;case"2":n.setCurrentSystem(le[1]),n.setCurrentPreset(null);break;case"3":n.setCurrentSystem(le[2]),n.setCurrentPreset(null);break;case"s":case"S":n.setSideBySideMode(!n.sideBySideMode),n.sideBySideMode||n.resetSimulation();break;case"t":case"T":{const o=oe.indexOf(n.colorTheme),u=oe[(o+1)%oe.length];n.setColorTheme(u);break}case"h":case"H":case"?":a();break;case"p":case"P":t();break;case"l":case"L":try{navigator.clipboard.writeText(xe())}catch{window.prompt("Share this URL:",xe())}break;case"c":case"C":n.setCinematicCamera(!n.cinematicCamera);break;case"a":case"A":n.setChaosAutopilot(!n.chaosAutopilot);break;case"Escape":n.storyMode?(n.setStoryMode(!1),n.setCinematicCamera(!1)):n.showBifurcation?n.setShowBifurcation(!1):n.showPoincare?n.setShowPoincare(!1):n.showParameterSpace?n.setShowParameterSpace(!1):n.cinematicCamera&&n.setCinematicCamera(!1);break}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[a,t])}const Tt=c.lazy(()=>ce(()=>import("./BifurcationDiagram-B0YfiTJ0.js"),__vite__mapDeps([0,1,2])).then(a=>({default:a.BifurcationDiagram}))),Ct=c.lazy(()=>ce(()=>import("./PoincareSection-CS_UtGC0.js"),__vite__mapDeps([3,1,4])).then(a=>({default:a.PoincareSection}))),Mt=c.lazy(()=>ce(()=>import("./ParameterSpace-DBD9JeMb.js"),__vite__mapDeps([5,1,6])).then(a=>({default:a.ParameterSpace})));function kt(){const a=z(t=>t.setIsPlaying);c.useEffect(()=>{const t=window.matchMedia("(prefers-reduced-motion: reduce)");t.matches&&a(!1);const s=r=>{r.matches&&a(!1)};return t.addEventListener("change",s),()=>t.removeEventListener("change",s)},[a])}function Et(){const{colorTheme:a,currentSystem:t}=z(),s=F[a],[r,i]=c.useState(!1),n=c.useCallback(()=>i(u=>!u),[]);kt(),Rt(n),Pt();const o=t==="lorenz"?"Lorenz Attractor":t==="rossler"?"RÃ¶ssler Attractor":"Double Pendulum";return e.jsxs("div",{className:"app",style:{"--bg":s.bg,"--text":s.text,"--accent":s.accent},children:[e.jsx("a",{href:"#controls-region",className:"skip-link",children:"Skip to controls"}),e.jsxs("div",{className:"sr-only",role:"status","aria-live":"polite","aria-atomic":"true",children:["Now viewing: ",o]}),e.jsx("main",{children:e.jsx(ot,{})}),e.jsx(dt,{}),e.jsx("div",{id:"controls-region",children:e.jsx(ht,{})}),e.jsx(pt,{}),e.jsx(gt,{}),e.jsxs(c.Suspense,{fallback:null,children:[e.jsx(Tt,{}),e.jsx(Ct,{}),e.jsx(Mt,{})]}),e.jsx(bt,{isVisible:r,onClose:n}),e.jsx(xt,{}),e.jsx(mt,{}),e.jsxs("div",{className:"title-overlay","aria-hidden":"true",children:[e.jsx("h1",{children:"Chaos Lab"}),e.jsx("p",{children:"Interactive Chaos Theory Visualizer"})]}),e.jsx("div",{className:"instructions","aria-hidden":"true",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Mouse:"})," Drag to rotate Â· Scroll to zoom Â· Right-drag to pan",e.jsx("br",{}),e.jsx("strong",{children:"Touch:"})," Drag to rotate Â· Pinch to zoom"]})})]})}Ae.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(Et,{})}));export{F as T,z as u};
