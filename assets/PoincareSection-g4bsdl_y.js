import{r as c,j as f}from"./three-vendor-CMdyc2H8.js";import{u as W,T as $}from"./index-DebvjheT.js";const y=500,u=400,G=()=>{const{showPoincare:i,setShowPoincare:N,colorTheme:F,currentSystem:m,isPlaying:b}=W(),x=$[F],C=c.useRef(null),d=c.useRef(0),v=c.useRef(0),A=c.useCallback(()=>{switch(m){case"lorenz":return{x:"x",y:"y",title:"Lorenz PoincarÃ© Section (z maxima)"};case"rossler":return{x:"x",y:"z",title:"RÃ¶ssler PoincarÃ© Section (y = 0 crossing)"};case"doublePendulum":return{x:"Î¸â‚",y:"Ï‰â‚",title:"Pendulum PoincarÃ© Section (Î¸â‚‚ = 0)"};default:return{x:"x",y:"y",title:"PoincarÃ© Section"}}},[m]),o=c.useCallback(()=>{const k=C.current;if(!k||!i)return;const e=k.getContext("2d");if(!e)return;const T=window.__chaosLabSystem;if(!T||!T.poincarePoints)return;const l=T.poincarePoints;if(l.length===v.current&&l.length>0){d.current=requestAnimationFrame(o);return}if(v.current=l.length,e.fillStyle="#0a0a18",e.fillRect(0,0,y,u),l.length===0){e.fillStyle="rgba(255,255,255,0.3)",e.font="13px system-ui, sans-serif",e.textAlign="center",e.fillText("Collecting points... let the simulation run.",y/2,u/2),d.current=requestAnimationFrame(o);return}let a=1/0,h=-1/0,r=1/0,p=-1/0;for(const[t,s]of l)t<a&&(a=t),t>h&&(h=t),s<r&&(r=s),s>p&&(p=s);const I=h-a||1,X=p-r||1,E=I*.1,R=X*.1;a-=E,h+=E,r-=R,p+=R;const n=40,P=y-2*n,g=u-2*n,Y=t=>n+(t-a)/(h-a)*P,H=t=>n+g-(t-r)/(p-r)*g;e.strokeStyle="rgba(255,255,255,0.06)",e.lineWidth=1;for(let t=0;t<=5;t++){const s=n+t/5*P,S=n+t/5*g;e.beginPath(),e.moveTo(s,n),e.lineTo(s,n+g),e.stroke(),e.beginPath(),e.moveTo(n,S),e.lineTo(n+P,S),e.stroke()}const w=l.length;for(let t=0;t<w;t++){const[s,S]=l[t],_=Y(s),q=H(S),L=.15+t/w*.7,M=x.trailHue1*360;e.fillStyle=`hsla(${M}, 85%, 60%, ${L})`,e.beginPath(),e.arc(_,q,2,0,Math.PI*2),e.fill()}const z=A();e.fillStyle="rgba(255,255,255,0.5)",e.font="11px system-ui, sans-serif",e.textAlign="center";for(let t=0;t<=4;t++){const s=a+t/4*(h-a);e.fillText(s.toFixed(1),n+t/4*P,u-6)}e.textAlign="right";for(let t=0;t<=4;t++){const s=r+t/4*(p-r);e.fillText(s.toFixed(1),n-4,n+g-t/4*g+4)}e.fillStyle="rgba(255,255,255,0.6)",e.font="12px system-ui, sans-serif",e.textAlign="center",e.fillText(z.x,y/2,u-18),e.save(),e.translate(14,u/2),e.rotate(-Math.PI/2),e.fillText(z.y,0,0),e.restore(),e.fillStyle="rgba(255,255,255,0.3)",e.font="10px system-ui, sans-serif",e.textAlign="right",e.fillText(`${w} points`,y-n,n-6),b&&(d.current=requestAnimationFrame(o))},[i,m,b,x,A]);if(c.useEffect(()=>(i&&(v.current=0,o()),()=>{d.current&&cancelAnimationFrame(d.current)}),[i,o]),c.useEffect(()=>{i&&b&&o()},[b,i,o]),!i)return null;const j=A();return f.jsxs("div",{className:"poincare-overlay",role:"dialog","aria-label":j.title,"aria-modal":"false",style:{"--panel-bg":x.panelBg,"--panel-border":x.panelBorder,"--text":x.text,"--accent":x.accent},children:[f.jsxs("div",{className:"poincare-header",children:[f.jsxs("h3",{children:["ðŸŽ¯ ",j.title]}),f.jsx("button",{className:"poincare-close",onClick:()=>N(!1),"aria-label":"Close PoincarÃ© section",children:"âœ•"})]}),f.jsx("div",{className:"poincare-canvas-wrap",children:f.jsx("canvas",{ref:C,width:y,height:u,className:"poincare-canvas"})}),f.jsxs("p",{className:"poincare-hint",children:["Points appear where the trajectory crosses a specific plane in phase space.",m==="lorenz"&&" Each dot marks a local maximum of z.",m==="rossler"&&" Each dot marks where y crosses zero (ascending).",m==="doublePendulum"&&" Each dot marks where Î¸â‚‚ passes through zero."]})]})};export{G as PoincareSection};
