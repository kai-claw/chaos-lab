import{r as x,j as i}from"./three-vendor-CMdyc2H8.js";import{u as U,T as je}from"./index-HQdGXcjv.js";const se=500,re=400,we=()=>{const{showParameterSpace:j,setShowParameterSpace:Y,colorTheme:le,currentSystem:h,setLorenzParams:ne,setRosslerParams:ie,resetSimulation:oe,setCurrentSystem:W}=U(),M=je[le],G=x.useRef(null),F=x.useRef(null),B=x.useRef(!1),V=x.useRef(0),[ce,J]=x.useState(!1),[fe,pe]=x.useState(0),D=U(e=>e.lorenzParams),q=U(e=>e.rosslerParams),R=x.useCallback(()=>h==="lorenz"?{xLabel:"Ïƒ (sigma)",yLabel:"Ï (rho)",xMin:1,xMax:30,yMin:1,yMax:50,xSteps:120,ySteps:100,title:"Lorenz Parameter Space (Lyapunov)",currentX:D.sigma,currentY:D.rho}:h==="rossler"?{xLabel:"a",yLabel:"c",xMin:.05,xMax:.5,yMin:1,yMax:20,xSteps:100,ySteps:100,title:"RÃ¶ssler Parameter Space (Lyapunov)",currentX:q.a,currentY:q.c}:null,[h,D,q]),H=x.useCallback(()=>{const e=G.current,a=R();if(!e||!a)return;const t=a,s=e.getContext("2d");if(!s)return;const n=s,r=e.width,f=e.height;n.fillStyle="#0a0a18",n.fillRect(0,0,r,f);const{xMin:N,xMax:me,yMin:Z,yMax:ue,xSteps:$,ySteps:C}=t;J(!0);let w=0;const de=5,ye=500,Me=300,u=.01;function ee(){for(let te=0;te<de&&w<C;te++,w++){const P=Z+w/C*(ue-Z);for(let T=0;T<$;T++){const k=N+T/$*(me-N);let l=1,o=1,c=1,d=1,y=0,b=0,ae=0,I=0;for(let p=0;p<ye;p++){let g,S,v;if(h==="lorenz"?(g=k*(o-l),S=l*(P-c)-o,v=l*o-8/3*c):(g=-o-c,S=l+k*o,v=.2+c*(l-P)),l+=g*u,o+=S*u,c+=v*u,Math.abs(l)>1e6){l=1,o=1,c=1;break}}for(let p=0;p<Me;p++){let g,S,v,_,K,O;if(h==="lorenz"?(g=k*(o-l),S=l*(P-c)-o,v=l*o-8/3*c,_=k*(y-d),K=(P-c)*d-y-l*b,O=o*d+l*y-8/3*b):(g=-o-c,S=l+k*o,v=.2+c*(l-P),_=-y-b,K=d+k*y,O=c*d+(l-P)*b),l+=g*u,o+=S*u,c+=v*u,d+=_*u,y+=K*u,b+=O*u,Math.abs(l)>1e6)break;if(p%10===9){const z=Math.sqrt(d*d+y*y+b*b);z>0&&isFinite(z)&&(ae+=Math.log(z),I++,d/=z,y/=z,b/=z)}}const L=I>0?ae/(I*10*u):0;let A,E,X;if(L>.1){const p=Math.min(1,L/3);A=180+75*p,E=30+180*p,X=20}else if(L>-.05)A=180,E=200,X=40;else{const p=Math.min(1,Math.abs(L)/5);A=10,E=30+100*(1-p),X=80+150*(1-p)}const be=Math.floor(T/$*r),ge=Math.floor(f-(w+1)/C*f),Se=Math.ceil(r/$)+1,ve=Math.ceil(f/C)+1;n.fillStyle=`rgb(${A},${E},${X})`,n.fillRect(be,ge,Se,ve)}}pe(Math.round(w/C*100)),w<C?V.current=requestAnimationFrame(ee):(B.current=!0,J(!1),xe(n,r,f,t))}ee()},[h,R]),xe=(e,a,t,s)=>{e.fillStyle="rgba(255,255,255,0.4)",e.font="10px system-ui, sans-serif",e.textAlign="center";for(let r=0;r<=5;r++){const f=s.xMin+r/5*(s.xMax-s.xMin);e.fillText(f.toFixed(1),r/5*a,t-4)}e.textAlign="left";for(let r=0;r<=5;r++){const f=s.yMin+r/5*(s.yMax-s.yMin);e.fillText(f.toFixed(1),4,t-r/5*t+4)}const n=14;e.font="10px system-ui, sans-serif",e.textAlign="left",e.fillStyle="rgb(255, 210, 20)",e.fillRect(a-130,n,10,10),e.fillStyle="rgba(255,255,255,0.5)",e.fillText("Chaotic (Î» > 0)",a-116,n+9),e.fillStyle="rgb(10, 130, 230)",e.fillRect(a-130,n+16,10,10),e.fillStyle="rgba(255,255,255,0.5)",e.fillText("Stable (Î» < 0)",a-116,n+25)},Q=x.useCallback(()=>{const e=F.current,a=R();if(!e||!a)return;const t=e.getContext("2d");if(!t)return;t.clearRect(0,0,e.width,e.height);const s=(a.currentX-a.xMin)/(a.xMax-a.xMin)*e.width,n=e.height-(a.currentY-a.yMin)/(a.yMax-a.yMin)*e.height;t.strokeStyle="rgba(255, 255, 255, 0.5)",t.lineWidth=1,t.setLineDash([3,3]),t.beginPath(),t.moveTo(s,0),t.lineTo(s,e.height),t.stroke(),t.beginPath(),t.moveTo(0,n),t.lineTo(e.width,n),t.stroke(),t.setLineDash([]),t.strokeStyle="rgba(255, 255, 255, 0.9)",t.lineWidth=2,t.beginPath(),t.arc(s,n,6,0,Math.PI*2),t.stroke(),t.fillStyle="rgba(255, 255, 255, 0.8)",t.font="bold 11px system-ui, sans-serif",t.textAlign=s>e.width/2?"right":"left";const r=s>e.width/2?s-10:s+10;t.fillText(`${a.xLabel.split(" ")[0]}=${a.currentX.toFixed(1)}, ${a.yLabel.split(" ")[0]}=${a.currentY.toFixed(1)}`,r,n-10)},[R]);x.useEffect(()=>(j&&!B.current&&H(),()=>{V.current&&cancelAnimationFrame(V.current)}),[j,H]),x.useEffect(()=>{j&&Q()},[j,Q]),x.useEffect(()=>{B.current=!1,j&&H()},[h]);const he=e=>{const a=F.current,t=R();if(!a||!t)return;const s=a.getBoundingClientRect(),n=e.clientX-s.left,r=e.clientY-s.top,f=t.xMin+n/s.width*(t.xMax-t.xMin),N=t.yMin+(1-r/s.height)*(t.yMax-t.yMin);h==="lorenz"?(W("lorenz"),ne({sigma:Math.round(f*10)/10,rho:Math.round(N*10)/10})):h==="rossler"&&(W("rossler"),ie({a:Math.round(f*100)/100,c:Math.round(N*10)/10})),oe()};if(!j)return null;const m=R();return m?i.jsxs("div",{className:"paramspace-overlay",role:"dialog","aria-label":m.title,"aria-modal":"false",onKeyDown:e=>{e.key==="Escape"&&Y(!1)},style:{"--panel-bg":M.panelBg,"--panel-border":M.panelBorder,"--text":M.text,"--accent":M.accent},children:[i.jsxs("div",{className:"paramspace-header",children:[i.jsxs("h3",{children:["ðŸ—ºï¸ ",m.title]}),i.jsx("button",{className:"paramspace-close",onClick:()=>Y(!1),"aria-label":"Close parameter space explorer",children:"âœ•"})]}),i.jsxs("div",{className:"paramspace-canvas-wrap",children:[i.jsx("canvas",{ref:G,width:se,height:re,className:"paramspace-canvas"}),i.jsx("canvas",{ref:F,width:se,height:re,className:"paramspace-canvas-overlay",onClick:he,title:"Click to set parameters"}),ce&&i.jsx("div",{className:"paramspace-progress",children:i.jsx("div",{className:"paramspace-progress-bar",style:{width:`${fe}%`}})})]}),i.jsxs("p",{className:"paramspace-hint",children:["Click anywhere to jump to those parameters. Red/yellow = chaotic, blue = stable.",h==="lorenz"&&` X: Ïƒ (${m.xMin}â€“${m.xMax}), Y: Ï (${m.yMin}â€“${m.yMax}), Î² fixed at 8/3.`,h==="rossler"&&` X: a (${m.xMin}â€“${m.xMax}), Y: c (${m.yMin}â€“${m.yMax}), b fixed at 0.2.`]})]}):i.jsxs("div",{className:"paramspace-overlay",style:{"--panel-bg":M.panelBg,"--panel-border":M.panelBorder,"--text":M.text,"--accent":M.accent},children:[i.jsxs("div",{className:"paramspace-header",children:[i.jsx("h3",{children:"ðŸ—ºï¸ Parameter Space"}),i.jsx("button",{className:"paramspace-close",onClick:()=>Y(!1),children:"âœ•"})]}),i.jsx("p",{className:"paramspace-hint",children:"Parameter space exploration is available for Lorenz and RÃ¶ssler systems."})]})};export{we as ParameterSpace};
