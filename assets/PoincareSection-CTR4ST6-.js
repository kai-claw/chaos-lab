import{r as c,j as f}from"./three-vendor-CMdyc2H8.js";import{u as B,T as L,s as V}from"./index-HQdGXcjv.js";const g=500,u=400,J=()=>{const{showPoincare:i,setShowPoincare:N,colorTheme:F,currentSystem:m,isPlaying:P}=B(),x=L[F],C=c.useRef(null),d=c.useRef(0),v=c.useRef(0),A=c.useCallback(()=>{switch(m){case"lorenz":return{x:"x",y:"y",title:"Lorenz PoincarÃ© Section (z maxima)"};case"rossler":return{x:"x",y:"z",title:"RÃ¶ssler PoincarÃ© Section (y = 0 crossing)"};case"doublePendulum":return{x:"Î¸â‚",y:"Ï‰â‚",title:"Pendulum PoincarÃ© Section (Î¸â‚‚ = 0)"};default:return{x:"x",y:"y",title:"PoincarÃ© Section"}}},[m]),o=c.useCallback(()=>{const R=C.current;if(!R||!i)return;const e=R.getContext("2d");if(!e)return;const k=V.system;if(!k?.poincarePoints)return;const l=k.poincarePoints;if(l.length===v.current&&l.length>0){d.current=requestAnimationFrame(o);return}if(v.current=l.length,e.fillStyle="#0a0a18",e.fillRect(0,0,g,u),l.length===0){e.fillStyle="rgba(255,255,255,0.3)",e.font="13px system-ui, sans-serif",e.textAlign="center",e.fillText("Collecting points... let the simulation run.",g/2,u/2),d.current=requestAnimationFrame(o);return}let a=1/0,h=-1/0,r=1/0,p=-1/0;for(const[t,s]of l)t<a&&(a=t),t>h&&(h=t),s<r&&(r=s),s>p&&(p=s);const I=h-a||1,X=p-r||1,w=I*.1,E=X*.1;a-=w,h+=w,r-=E,p+=E;const n=40,b=g-2*n,y=u-2*n,Y=t=>n+(t-a)/(h-a)*b,H=t=>n+y-(t-r)/(p-r)*y;e.strokeStyle="rgba(255,255,255,0.06)",e.lineWidth=1;for(let t=0;t<=5;t++){const s=n+t/5*b,S=n+t/5*y;e.beginPath(),e.moveTo(s,n),e.lineTo(s,n+y),e.stroke(),e.beginPath(),e.moveTo(n,S),e.lineTo(n+b,S),e.stroke()}const T=l.length;for(let t=0;t<T;t++){const[s,S]=l[t],q=Y(s),M=H(S),W=.15+t/T*.7,$=x.trailHue1*360;e.fillStyle=`hsla(${$}, 85%, 60%, ${W})`,e.beginPath(),e.arc(q,M,2,0,Math.PI*2),e.fill()}const z=A();e.fillStyle="rgba(255,255,255,0.5)",e.font="11px system-ui, sans-serif",e.textAlign="center";for(let t=0;t<=4;t++){const s=a+t/4*(h-a);e.fillText(s.toFixed(1),n+t/4*b,u-6)}e.textAlign="right";for(let t=0;t<=4;t++){const s=r+t/4*(p-r);e.fillText(s.toFixed(1),n-4,n+y-t/4*y+4)}e.fillStyle="rgba(255,255,255,0.6)",e.font="12px system-ui, sans-serif",e.textAlign="center",e.fillText(z.x,g/2,u-18),e.save(),e.translate(14,u/2),e.rotate(-Math.PI/2),e.fillText(z.y,0,0),e.restore(),e.fillStyle="rgba(255,255,255,0.3)",e.font="10px system-ui, sans-serif",e.textAlign="right",e.fillText(`${T} points`,g-n,n-6),P&&(d.current=requestAnimationFrame(o))},[i,m,P,x,A]);if(c.useEffect(()=>(i&&(v.current=0,o()),()=>{d.current&&cancelAnimationFrame(d.current)}),[i,o]),c.useEffect(()=>{i&&P&&o()},[P,i,o]),!i)return null;const j=A();return f.jsxs("div",{className:"poincare-overlay",role:"dialog","aria-label":j.title,"aria-modal":"false",style:{"--panel-bg":x.panelBg,"--panel-border":x.panelBorder,"--text":x.text,"--accent":x.accent},children:[f.jsxs("div",{className:"poincare-header",children:[f.jsxs("h3",{children:["ðŸŽ¯ ",j.title]}),f.jsx("button",{className:"poincare-close",onClick:()=>N(!1),"aria-label":"Close PoincarÃ© section",children:"âœ•"})]}),f.jsx("div",{className:"poincare-canvas-wrap",children:f.jsx("canvas",{ref:C,width:g,height:u,className:"poincare-canvas"})}),f.jsxs("p",{className:"poincare-hint",children:["Points appear where the trajectory crosses a specific plane in phase space.",m==="lorenz"&&" Each dot marks a local maximum of z.",m==="rossler"&&" Each dot marks where y crosses zero (ascending).",m==="doublePendulum"&&" Each dot marks where Î¸â‚‚ passes through zero."]})]})};export{J as PoincareSection};
