import{r as m,j as u}from"./three-vendor-BMWzMgmY.js";import{u as Q,T as U}from"./index-BlOp_DQ5.js";const w=0,i=200,A=600,b=300,V=5e3,Y=3e3,x=.005,ee=15,te=20,C=50,ne=40,re="rgba(100, 180, 255, 0.35)",I=1.5,se=()=>{const{showBifurcation:g,setShowBifurcation:D,lorenzParams:h,setLorenzParams:F,colorTheme:H,resetSimulation:Z,setCurrentSystem:X}=Q(),y=U[H],z=m.useRef(null),p=m.useRef(null),T=m.useRef(0),M=m.useCallback(()=>{const e=z.current;if(!e)return;const n=e.getContext("2d");if(!n)return;const t=n,a=e.width,r=e.height;t.fillStyle="#0a0a18",t.fillRect(0,0,a,r),t.strokeStyle="rgba(255,255,255,0.06)",t.lineWidth=1;for(let l=0;l<=i;l+=te){const c=l/i*a;t.beginPath(),t.moveTo(c,0),t.lineTo(c,r),t.stroke()}for(let l=0;l<=b;l+=C){const c=r-l/b*r;t.beginPath(),t.moveTo(0,c),t.lineTo(a,c),t.stroke()}let d=0;const P=10,j=8/3;function L(){for(let l=0;l<ee&&d<A;l++,d++){const c=w+d/A*(i-w);let s=1,f=1,o=1;for(let v=0;v<V;v++){const S=P*(f-s),E=s*(c-o)-f,k=s*f-j*o;if(s+=S*x,f+=E*x,o+=k*x,Math.abs(s)>1e6){s=1,f=1,o=1;break}}let B=o,N=0;for(let v=0;v<Y;v++){const S=P*(f-s),E=s*(c-o)-f,k=s*f-j*o;if(s+=S*x,f+=E*x,o+=k*x,Math.abs(s)>1e6)break;const O=o-B;if(N>0&&O<=0&&o>0&&o<b){const q=c/i*a,J=r-o/b*r;t.fillStyle=re,t.fillRect(q,J,I,I)}N=O,B=o}}d<A?T.current=requestAnimationFrame(L):$(t,a,r)}L()},[]),$=(e,n,t)=>{e.fillStyle="rgba(255,255,255,0.5)",e.font="11px system-ui, sans-serif",e.textAlign="center";for(let a=0;a<=i;a+=ne){const r=a/i*n;e.fillText(`${a}`,r,t-4)}e.textAlign="left";for(let a=C;a<=b;a+=C){const r=t-a/b*t;e.fillText(`${a}`,4,r+4)}e.fillStyle="rgba(255,255,255,0.6)",e.font="12px system-ui, sans-serif",e.textAlign="center",e.fillText("œÅ (rho)",n/2,t-16),e.save(),e.translate(16,t/2),e.rotate(-Math.PI/2),e.fillText("z maxima",0,0),e.restore()},_=m.useCallback(()=>{const e=p.current;if(!e)return;const n=e.getContext("2d");if(!n)return;const t=e.width,a=e.height;n.clearRect(0,0,t,a);const r=h.rho/i*t;n.strokeStyle="rgba(255, 100, 100, 0.8)",n.lineWidth=2,n.setLineDash([4,4]),n.beginPath(),n.moveTo(r,0),n.lineTo(r,a),n.stroke(),n.setLineDash([]),n.fillStyle="rgba(255, 100, 100, 0.9)",n.font="bold 11px system-ui, sans-serif",n.textAlign=r>t/2?"right":"left";const d=r>t/2?r-6:r+6;n.fillText(`œÅ = ${h.rho.toFixed(1)}`,d,16)},[h.rho]);m.useEffect(()=>(g&&M(),()=>{T.current&&(cancelAnimationFrame(T.current),T.current=0)}),[g,M]),m.useEffect(()=>{g&&_()},[g,_]);const W=e=>{const n=p.current;if(!n)return null;const t=n.getBoundingClientRect(),r=(e.clientX-t.left)/t.width*i;return Math.max(.1,Math.min(i,Math.round(r*10)/10))},R=e=>{X("lorenz"),F({rho:e}),Z()},G=e=>{const n=W(e);n!==null&&R(n)},K=e=>{e.key==="Escape"?D(!1):e.key==="ArrowLeft"?R(Math.max(.1,h.rho-1)):e.key==="ArrowRight"&&R(Math.min(i,h.rho+1))};return g?u.jsxs("div",{className:"bifurcation-overlay",role:"dialog","aria-label":"Lorenz bifurcation diagram","aria-modal":"false",onKeyDown:K,style:{"--panel-bg":y.panelBg,"--panel-border":y.panelBorder,"--text":y.text,"--accent":y.accent},children:[u.jsxs("div",{className:"bifurcation-header",children:[u.jsx("h3",{children:"üìä Lorenz Bifurcation Diagram"}),u.jsx("button",{className:"bifurcation-close",onClick:()=>D(!1),"aria-label":"Close bifurcation diagram",children:"‚úï"})]}),u.jsxs("div",{className:"bifurcation-canvas-wrap",children:[u.jsx("canvas",{ref:z,width:600,height:380,className:"bifurcation-canvas","aria-hidden":"true"}),u.jsx("canvas",{ref:p,width:600,height:380,className:"bifurcation-canvas-overlay",onClick:G,role:"slider","aria-label":`Rho value selector, current value ${h.rho.toFixed(1)}`,"aria-valuenow":h.rho,"aria-valuemin":w,"aria-valuemax":i,tabIndex:0})]}),u.jsx("p",{className:"bifurcation-hint",children:"Click or use ‚Üê ‚Üí arrow keys to set œÅ value. Press Escape to close."})]}):null};export{se as BifurcationDiagram};
